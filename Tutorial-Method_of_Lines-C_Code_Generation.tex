\documentclass[landscape,letterpaper,10pt,english]{article}

    \usepackage[breakable]{tcolorbox}
    \usepackage{parskip} % Stop auto-indenting (to mimic markdown behaviour)
    

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % Maintain compatibility with old templates. Remove in nbconvert 6.0
    \let\Oldincludegraphics\includegraphics
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionFormat{nocaption}{}
    \captionsetup{format=nocaption,aboveskip=0pt,belowskip=0pt}

    \usepackage{float}
    \floatplacement{figure}{H} % forces figures to be placed at the correct location
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro

    \usepackage{iftex}
    \ifPDFTeX
        \usepackage[T1]{fontenc}
        \IfFileExists{alphabeta.sty}{
              \usepackage{alphabeta}
          }{
              \usepackage[mathletters]{ucs}
              \usepackage[utf8x]{inputenc}
          }
    \else
        \usepackage{fontspec}
        \usepackage{unicode-math}
    \fi

    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics
                         % to support a larger range
    \makeatletter % fix for old versions of grffile with XeLaTeX
    \@ifpackagelater{grffile}{2019/11/01}
    {
      % Do nothing on new versions
    }
    {
      \def\Gread@@xetex#1{%
        \IfFileExists{"\Gin@base".bb}%
        {\Gread@eps{\Gin@base.bb}}%
        {\Gread@@xetex@aux#1}%
      }
    }
    \makeatother
    \usepackage[Export]{adjustbox} % Used to constrain images to a maximum size
    \adjustboxset{max size={0.9\linewidth}{0.9\paperheight}}

    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    % The default LaTeX title has an obnoxious amount of whitespace. By default,
    % titling removes some of it. It also provides customization options.
    \usepackage{titling}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage{array}     % table support for pandoc >= 2.11.3
    \usepackage{calc}      % table minipage width calculation for pandoc >= 2.11.1
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    \usepackage{mathrsfs}
    

    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}
    \definecolor{ansi-default-inverse-fg}{HTML}{FFFFFF}
    \definecolor{ansi-default-inverse-bg}{HTML}{000000}

    % common color for the border for error outputs.
    \definecolor{outerrorbackground}{HTML}{FFDFDF}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}

    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}


    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatibility definitions
    \def\gt{>}
    \def\lt{<}
    \let\Oldtex\TeX
    \let\Oldlatex\LaTeX
    \renewcommand{\TeX}{\textrm{\Oldtex}}
    \renewcommand{\LaTeX}{\textrm{\Oldlatex}}
    % Document parameters
    % Document title
    \title{Tutorial-Method\_of\_Lines-C\_Code\_Generation}
    
    
    
    
    
% Pygments definitions
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\@namedef{PY@tok@w}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\@namedef{PY@tok@c}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cp}{\def\PY@tc##1{\textcolor[rgb]{0.61,0.40,0.00}{##1}}}
\@namedef{PY@tok@k}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kp}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kt}{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\@namedef{PY@tok@o}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@ow}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\@namedef{PY@tok@nb}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@nf}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@nc}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@nn}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@ne}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.80,0.25,0.22}{##1}}}
\@namedef{PY@tok@nv}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@no}{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\@namedef{PY@tok@nl}{\def\PY@tc##1{\textcolor[rgb]{0.46,0.46,0.00}{##1}}}
\@namedef{PY@tok@ni}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.44,0.44,0.44}{##1}}}
\@namedef{PY@tok@na}{\def\PY@tc##1{\textcolor[rgb]{0.41,0.47,0.13}{##1}}}
\@namedef{PY@tok@nt}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@nd}{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\@namedef{PY@tok@s}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sd}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@si}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.64,0.35,0.47}{##1}}}
\@namedef{PY@tok@se}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.36,0.12}{##1}}}
\@namedef{PY@tok@sr}{\def\PY@tc##1{\textcolor[rgb]{0.64,0.35,0.47}{##1}}}
\@namedef{PY@tok@ss}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@sx}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@m}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@gh}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\@namedef{PY@tok@gu}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\@namedef{PY@tok@gd}{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\@namedef{PY@tok@gi}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.52,0.00}{##1}}}
\@namedef{PY@tok@gr}{\def\PY@tc##1{\textcolor[rgb]{0.89,0.00,0.00}{##1}}}
\@namedef{PY@tok@ge}{\let\PY@it=\textit}
\@namedef{PY@tok@gs}{\let\PY@bf=\textbf}
\@namedef{PY@tok@gp}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\@namedef{PY@tok@go}{\def\PY@tc##1{\textcolor[rgb]{0.44,0.44,0.44}{##1}}}
\@namedef{PY@tok@gt}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\@namedef{PY@tok@err}{\def\PY@bc##1{{\setlength{\fboxsep}{\string -\fboxrule}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}}
\@namedef{PY@tok@kc}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kd}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kn}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kr}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@bp}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@fm}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@vc}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vg}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vi}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vm}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@sa}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sb}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sc}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@dl}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@s2}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sh}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@s1}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@mb}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mf}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mh}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mi}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@il}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mo}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@ch}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cm}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cpf}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@c1}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cs}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % For linebreaks inside Verbatim environment from package fancyvrb.
    \makeatletter
        \newbox\Wrappedcontinuationbox
        \newbox\Wrappedvisiblespacebox
        \newcommand*\Wrappedvisiblespace {\textcolor{red}{\textvisiblespace}}
        \newcommand*\Wrappedcontinuationsymbol {\textcolor{red}{\llap{\tiny$\m@th\hookrightarrow$}}}
        \newcommand*\Wrappedcontinuationindent {3ex }
        \newcommand*\Wrappedafterbreak {\kern\Wrappedcontinuationindent\copy\Wrappedcontinuationbox}
        % Take advantage of the already applied Pygments mark-up to insert
        % potential linebreaks for TeX processing.
        %        {, <, #, %, $, ' and ": go to next line.
        %        _, }, ^, &, >, - and ~: stay at end of broken line.
        % Use of \textquotesingle for straight quote.
        \newcommand*\Wrappedbreaksatspecials {%
            \def\PYGZus{\discretionary{\char`\_}{\Wrappedafterbreak}{\char`\_}}%
            \def\PYGZob{\discretionary{}{\Wrappedafterbreak\char`\{}{\char`\{}}%
            \def\PYGZcb{\discretionary{\char`\}}{\Wrappedafterbreak}{\char`\}}}%
            \def\PYGZca{\discretionary{\char`\^}{\Wrappedafterbreak}{\char`\^}}%
            \def\PYGZam{\discretionary{\char`\&}{\Wrappedafterbreak}{\char`\&}}%
            \def\PYGZlt{\discretionary{}{\Wrappedafterbreak\char`\<}{\char`\<}}%
            \def\PYGZgt{\discretionary{\char`\>}{\Wrappedafterbreak}{\char`\>}}%
            \def\PYGZsh{\discretionary{}{\Wrappedafterbreak\char`\#}{\char`\#}}%
            \def\PYGZpc{\discretionary{}{\Wrappedafterbreak\char`\%}{\char`\%}}%
            \def\PYGZdl{\discretionary{}{\Wrappedafterbreak\char`\$}{\char`\$}}%
            \def\PYGZhy{\discretionary{\char`\-}{\Wrappedafterbreak}{\char`\-}}%
            \def\PYGZsq{\discretionary{}{\Wrappedafterbreak\textquotesingle}{\textquotesingle}}%
            \def\PYGZdq{\discretionary{}{\Wrappedafterbreak\char`\"}{\char`\"}}%
            \def\PYGZti{\discretionary{\char`\~}{\Wrappedafterbreak}{\char`\~}}%
        }
        % Some characters . , ; ? ! / are not pygmentized.
        % This macro makes them "active" and they will insert potential linebreaks
        \newcommand*\Wrappedbreaksatpunct {%
            \lccode`\~`\.\lowercase{\def~}{\discretionary{\hbox{\char`\.}}{\Wrappedafterbreak}{\hbox{\char`\.}}}%
            \lccode`\~`\,\lowercase{\def~}{\discretionary{\hbox{\char`\,}}{\Wrappedafterbreak}{\hbox{\char`\,}}}%
            \lccode`\~`\;\lowercase{\def~}{\discretionary{\hbox{\char`\;}}{\Wrappedafterbreak}{\hbox{\char`\;}}}%
            \lccode`\~`\:\lowercase{\def~}{\discretionary{\hbox{\char`\:}}{\Wrappedafterbreak}{\hbox{\char`\:}}}%
            \lccode`\~`\?\lowercase{\def~}{\discretionary{\hbox{\char`\?}}{\Wrappedafterbreak}{\hbox{\char`\?}}}%
            \lccode`\~`\!\lowercase{\def~}{\discretionary{\hbox{\char`\!}}{\Wrappedafterbreak}{\hbox{\char`\!}}}%
            \lccode`\~`\/\lowercase{\def~}{\discretionary{\hbox{\char`\/}}{\Wrappedafterbreak}{\hbox{\char`\/}}}%
            \catcode`\.\active
            \catcode`\,\active
            \catcode`\;\active
            \catcode`\:\active
            \catcode`\?\active
            \catcode`\!\active
            \catcode`\/\active
            \lccode`\~`\~
        }
    \makeatother

    \let\OriginalVerbatim=\Verbatim
    \makeatletter
    \renewcommand{\Verbatim}[1][1]{%
        %\parskip\z@skip
        \sbox\Wrappedcontinuationbox {\Wrappedcontinuationsymbol}%
        \sbox\Wrappedvisiblespacebox {\FV@SetupFont\Wrappedvisiblespace}%
        \def\FancyVerbFormatLine ##1{\hsize\linewidth
            \vtop{\raggedright\hyphenpenalty\z@\exhyphenpenalty\z@
                \doublehyphendemerits\z@\finalhyphendemerits\z@
                \strut ##1\strut}%
        }%
        % If the linebreak is at a space, the latter will be displayed as visible
        % space at end of first line, and a continuation symbol starts next line.
        % Stretch/shrink are however usually zero for typewriter font.
        \def\FV@Space {%
            \nobreak\hskip\z@ plus\fontdimen3\font minus\fontdimen4\font
            \discretionary{\copy\Wrappedvisiblespacebox}{\Wrappedafterbreak}
            {\kern\fontdimen2\font}%
        }%

        % Allow breaks at special characters using \PYG... macros.
        \Wrappedbreaksatspecials
        % Breaks at punctuation characters . , ; ? ! and / need catcode=\active
        \OriginalVerbatim[#1,codes*=\Wrappedbreaksatpunct]%
    }
    \makeatother

    % Exact colors from NB
    \definecolor{incolor}{HTML}{303F9F}
    \definecolor{outcolor}{HTML}{D84315}
    \definecolor{cellborder}{HTML}{CFCFCF}
    \definecolor{cellbackground}{HTML}{F7F7F7}

    % prompt
    \makeatletter
    \newcommand{\boxspacing}{\kern\kvtcb@left@rule\kern\kvtcb@boxsep}
    \makeatother
    \newcommand{\prompt}[4]{
        {\ttfamily\llap{{\color{#2}[#3]:\hspace{3pt}#4}}\vspace{-\baselineskip}}
    }
    

    
    % Start the section counter at -1, so the Table of Contents is Section 0
    \setcounter{section}{-2}
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly smaller margins than the latex defaults
    
    \geometry{verbose,tmargin=0.5in,bmargin=0.5in,lmargin=0.5in,rmargin=0.5in}
    
    

\begin{document}
    
    \maketitle
    
    

    
    \hypertarget{generating-c-code-to-implement-method-of-lines-timestepping-for-explicit-runge-kutta-methods}{%
\section{Generating C Code to implement Method of Lines Timestepping for
Explicit Runge Kutta
Methods}\label{generating-c-code-to-implement-method-of-lines-timestepping-for-explicit-runge-kutta-methods}}

\hypertarget{authors-zach-etienne-brandon-clark}{%
\subsection{Authors: Zach Etienne \& Brandon
Clark}\label{authors-zach-etienne-brandon-clark}}

\hypertarget{this-tutorial-notebook-generates-three-blocks-of-c-code-in-order-to-perform-method-of-lines-timestepping.}{%
\subsection{This tutorial notebook generates three blocks of C Code in
order to perform Method of Lines
timestepping.}\label{this-tutorial-notebook-generates-three-blocks-of-c-code-in-order-to-perform-method-of-lines-timestepping.}}

\textbf{Notebook Status:} Validated

\textbf{Validation Notes:} This tutorial notebook has been confirmed to
be self-consistent with its corresponding NRPy+ module, as documented
\hyperref[code_validation]{below}. All Runge-Kutta (RK) Butcher tables
were validated using truncated Taylor series in
\href{Tutorial-RK_Butcher_Table_Validation.ipynb}{a separate module}.
Finally, C-code implementation of RK4 was validated against a trusted
version. C-code implementations of other RK methods seem to work as
expected in the context of solving the scalar wave equation in Cartesian
coordinates.

\hypertarget{nrpy-source-code-for-this-module}{%
\subsubsection{NRPy+ Source Code for this
module:}\label{nrpy-source-code-for-this-module}}

\begin{itemize}
\tightlist
\item
  \href{../edit/MoLtimestepping/C_Code_Generation.py}{MoLtimestepping/C\_Code\_Generation.py}
\item
  \href{../edit/MoLtimestepping/RK_Butcher_Table_Dictionary.py}{MoLtimestepping/RK\_Butcher\_Table\_Dictionary.py}
  (\href{Tutorial-RK_Butcher_Table_Dictionary.ipynb}{\textbf{Tutorial}})
  stores the Butcher tables for the explicit Runge Kutta methods.
\end{itemize}

\hypertarget{introduction}{%
\subsection{Introduction:}\label{introduction}}

When numerically solving a partial differential equation initial-value
problem, subject to suitable boundary conditions, we implement Method of
Lines to ``integrate'' the solution forward in time.

\hypertarget{the-method-of-lines}{%
\subsubsection{The Method of Lines:}\label{the-method-of-lines}}

Once we have the initial data for a PDE, we ``evolve it forward in
time'', using the
\href{https://reference.wolfram.com/language/tutorial/NDSolveMethodOfLines.html}{Method
of Lines}. In short, the Method of Lines enables us to handle 1. the
\textbf{spatial derivatives} of an initial value problem PDE using
\textbf{standard finite difference approaches}, and 2. the
\textbf{temporal derivatives} of an initial value problem PDE using
\textbf{standard strategies for solving ordinary differential equations
(ODEs), like Runge Kutta methods} so long as the initial value problem
PDE can be written in the first-order-in-time form
\[\partial_t \vec{f} = \mathbf{M}\ \vec{f},\] where \(\mathbf{M}\) is an
\(N\times N\) matrix containing only \emph{spatial} differential
operators that act on the \(N\)-element column vector \(\vec{f}\).
\(\mathbf{M}\) may not contain \(t\) or time derivatives explicitly;
only \emph{spatial} partial derivatives are allowed to appear inside
\(\mathbf{M}\).

You may find the module
\href{Tutorial-ScalarWave.ipynb}{Tutorial-ScalarWave} extremely helpful
as an example for implementing the Method of Lines for solving the
Scalar Wave equation in Cartesian coordinates.

\hypertarget{generating-the-c-code}{%
\subsubsection{Generating the C code:}\label{generating-the-c-code}}

This module describes how core C functions are generated to implement
Method of Lines timestepping for a specified RK method. There are three
core functions:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  allocate memory for gridfunctions,
\item
  step forward the solution one full timestep,
\item
  and free memory for gridfunctions.
\end{enumerate}

The first function is called first, then the second function is repeated
within a loop to a fixed ``final'' time (such that the end state of each
iteration is the initial state for the next iteration), and the third
function is called at the end of the calculation.

The generated codes are essential for a number of Start-to-Finish
example tutorial notebooks that demonstrate how to numerically solve
hyperbolic PDEs.

    \hypertarget{table-of-contents}{%
\section{Table of Contents}\label{table-of-contents}}

\[\label{toc}\]

This notebook is organized as follows

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \hyperref[initializenrpy]{Step 1}: Initialize needed Python/NRPy+
  modules
\item
  \hyperref[diagonal]{Step 2}: Checking if Butcher Table is Diagonal
\item
  \hyperref[ccode]{Step 3}: Generating the C Code

  \begin{enumerate}
  \def\labelenumii{\arabic{enumii}.}
  \tightlist
  \item
    \hyperref[generategfnames]{Step 3.a}:
    \texttt{generate\_gridfunction\_names()}: Uniquely and descriptively
    assign names to sets of gridfunctions
  \item
    \hyperref[alloc]{Step 3.b}: Memory allocation:
    \texttt{MoL\_malloc\_y\_n\_gfs()} and
    \texttt{MoL\_malloc\_non\_y\_n\_gfs()}
  \item
    \hyperref[molstep]{Step 3.c}: Take one Method of Lines time step:
    \texttt{MoL\_step\_forward\_in\_time()}
  \item
    \hyperref[free]{Step 3.d}: Memory deallocation:
    \texttt{MoL\_free\_memory()}
  \item
    \hyperref[nrpybasicdefines]{Step 3.e}: Define \& register
    \texttt{MoL\_gridfunctions\_struct} in
    \texttt{NRPy\_basic\_defines.h}:
    \texttt{NRPy\_basic\_defines\_MoL\_timestepping\_struct()}
  \item
    \hyperref[setupall]{Step 3.f}: Add all MoL C codes to C function
    dictionary, and add MoL definitions to
    \texttt{NRPy\_basic\_defines.h}:
    \texttt{register\_C\_functions\_and\_NRPy\_basic\_defines()}
  \end{enumerate}
\item
  \hyperref[code_validation]{Step 4}: Code Validation against
  \texttt{MoLtimestepping.RK\_Butcher\_Table\_Generating\_C\_Code} NRPy+
  module
\item
  \hyperref[latex_pdf_output]{Step 5}: Output this notebook to
  \(\LaTeX\)-formatted PDF file
\end{enumerate}

    \hypertarget{step-1-initialize-needed-pythonnrpy-modules-back-to-top}{%
\section{\texorpdfstring{Step 1: Initialize needed Python/NRPy+ modules
{[}Back to
\hyperref[toc]{top}{]}}{Step 1: Initialize needed Python/NRPy+ modules {[}Back to {]}}}\label{step-1-initialize-needed-pythonnrpy-modules-back-to-top}}

\[\label{initializenrpy}\]

Let's start by importing all the needed modules from Python/NRPy+:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{1}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import} \PY{n+nn}{sympy} \PY{k}{as} \PY{n+nn}{sp}  \PY{c+c1}{\PYZsh{} Import SymPy, a computer algebra system written entirely in Python}
\PY{k+kn}{import} \PY{n+nn}{os}\PY{o}{,} \PY{n+nn}{sys}      \PY{c+c1}{\PYZsh{} Standard Python modules for multiplatform OS\PYZhy{}level functions}
\PY{k+kn}{from} \PY{n+nn}{MoLtimestepping}\PY{n+nn}{.}\PY{n+nn}{RK\PYZus{}Butcher\PYZus{}Table\PYZus{}Dictionary} \PY{k+kn}{import} \PY{n}{Butcher\PYZus{}dict}
\PY{k+kn}{from} \PY{n+nn}{outputC} \PY{k+kn}{import} \PY{n}{add\PYZus{}to\PYZus{}Cfunction\PYZus{}dict}\PY{p}{,} \PY{n}{indent\PYZus{}Ccode}\PY{p}{,} \PY{n}{outC\PYZus{}NRPy\PYZus{}basic\PYZus{}defines\PYZus{}h\PYZus{}dict}\PY{p}{,} \PY{n}{superfast\PYZus{}uniq}\PY{p}{,} \PY{n}{outputC}  \PY{c+c1}{\PYZsh{} NRPy+: Basic C code output functionality}
\end{Verbatim}
\end{tcolorbox}

    \hypertarget{step-2-checking-if-a-butcher-table-is-diagonal-back-to-top}{%
\section{\texorpdfstring{Step 2: Checking if a Butcher table is Diagonal
{[}Back to
\hyperref[toc]{top}{]}}{Step 2: Checking if a Butcher table is Diagonal {[}Back to {]}}}\label{step-2-checking-if-a-butcher-table-is-diagonal-back-to-top}}

\[\label{diagonal}\]

A diagonal Butcher table takes the form

\[\begin{array}{c|cccccc}
    0 & \\
    a_1 & a_1 & \\ 
    a_2 & 0 & a_2 & \\
    a_3 & 0 & 0 & a_3 & \\ 
    \vdots & \vdots & \ddots & \ddots & \ddots \\ 
    a_s & 0 & 0 & 0 & \cdots & a_s \\ \hline
     & b_1 & b_2 & b_3 & \cdots & b_{s-1} & b_s
\end{array},\]

where \(s\) is the number of required predictor-corrector steps for a
given RK method (see
\href{https://onlinelibrary.wiley.com/doi/book/10.1002/9780470753767}{Butcher,
John C. (2008)}). One known diagonal RK method is the classic RK4
represented in Butcher table form below.

\[\begin{array}{c|cccc}
    0 & \\
    1/2 & 1/2 & \\ 
    1/2 & 0 & 1/2 & \\
    1 & 0 & 0 & 1 & \\ \hline
     & 1/6 & 1/3 & 1/3 & 1/6
\end{array} \]

Diagonal Butcher tables are nice when it comes to saving required memory
space. Each new step for a diagonal RK method, when computing the new
\(k_i\), does not depend on the previous calculation, and so there are
ways to save memory. Significantly so in large three-dimensional spatial
grid spaces.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{2}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Check if Butcher Table is diagonal}
\PY{k}{def} \PY{n+nf}{diagonal}\PY{p}{(}\PY{n}{key}\PY{p}{)}\PY{p}{:}
    \PY{c+c1}{\PYZsh{} Get the Butcher table corresponding to the provided key}
    \PY{n}{Butcher} \PY{o}{=} \PY{n}{Butcher\PYZus{}dict}\PY{p}{[}\PY{n}{key}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}

    \PY{c+c1}{\PYZsh{} Establish the number of rows to check for diagonal trait, all but the last row}
    \PY{n}{L} \PY{o}{=} \PY{n+nb}{len}\PY{p}{(}\PY{n}{Butcher}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}

    \PY{c+c1}{\PYZsh{} Initialize the Butcher table row index}
    \PY{n}{row\PYZus{}idx} \PY{o}{=} \PY{l+m+mi}{0}

    \PY{c+c1}{\PYZsh{} Check all the desired rows}
    \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{L}\PY{p}{)}\PY{p}{:}
        \PY{c+c1}{\PYZsh{} Check each element before the diagonal element in a row}
        \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{row\PYZus{}idx}\PY{p}{)}\PY{p}{:}
            \PY{c+c1}{\PYZsh{} If any non\PYZhy{}diagonal coefficient is non\PYZhy{}zero, then the table is not diagonal}
            \PY{k}{if} \PY{n}{Butcher}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{[}\PY{n}{j}\PY{p}{]} \PY{o}{!=} \PY{n}{sp}\PY{o}{.}\PY{n}{sympify}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{:}
                \PY{k}{return} \PY{k+kc}{False}

        \PY{c+c1}{\PYZsh{} Update to check the next row}
        \PY{n}{row\PYZus{}idx} \PY{o}{+}\PY{o}{=} \PY{l+m+mi}{1}

    \PY{c+c1}{\PYZsh{} If all non\PYZhy{}diagonal elements are zero, the table is diagonal}
    \PY{k}{return} \PY{k+kc}{True}
\end{Verbatim}
\end{tcolorbox}

    \hypertarget{step-3-generating-the-c-code-back-to-top}{%
\section{\texorpdfstring{Step 3: Generating the C Code {[}Back to
\hyperref[toc]{top}{]}}{Step 3: Generating the C Code {[}Back to {]}}}\label{step-3-generating-the-c-code-back-to-top}}

\[\label{ccode}\]

The following sections build up the C code for implementing the
\href{http://www.scholarpedia.org/article/Method_of_lines}{Method of
Lines timestepping algorithm} for solving hyperbolic PDEs.

\textbf{First, an important note on efficiency.}

Memory efficiency is incredibly important here, as \(\vec{f}\) is
usually the largest object in memory.

If we only made use of the Butcher tables without concern for memory
efficiency, \texttt{generate\_gridfunction\_names()} and
\texttt{MoL\_step\_forward\_in\_time()} would be very simple functions.

It turns out that several of the Runge-Kutta-like methods in MoL can be
made more efficient; for example ``RK4'' can be performed using only 4
``timelevels'' of \(\vec{f}\) in memory (i.e., a total memory usage of
\texttt{sizeof(f)\ *\ 4}). A naive implementation might use 5 or 6
copies. RK-like methods that have diagonal Butcher tables can be made
far more efficient than the naive approach.

\textbf{Exercise to student:} Improve the efficiency of other RK-like
methods.

    \hypertarget{step-3.a-generate_gridfunction_names-uniquely-and-descriptively-assign-names-to-sets-of-gridfunctions-back-to-top}{%
\subsection{\texorpdfstring{Step 3.a:
\texttt{generate\_gridfunction\_names()}: Uniquely and descriptively
assign names to sets of gridfunctions {[}Back to
\hyperref[toc]{top}{]}}{Step 3.a: generate\_gridfunction\_names(): Uniquely and descriptively assign names to sets of gridfunctions {[}Back to {]}}}\label{step-3.a-generate_gridfunction_names-uniquely-and-descriptively-assign-names-to-sets-of-gridfunctions-back-to-top}}

\[\label{generategfnames}\]

\texttt{generate\_gridfunction\_names()} names gridfunctions to be
consistent with a given RK substep. For example, we might call the set
of gridfunctions stored at substep \(k_1\) \texttt{k1\_gfs}.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{3}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def} \PY{n+nf}{generate\PYZus{}gridfunction\PYZus{}names}\PY{p}{(}\PY{n}{MoL\PYZus{}method}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{RK4}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{:}
    \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}}
\PY{l+s+sd}{    Generate gridfunction names for the specified Method of Lines (MoL) method.}

\PY{l+s+sd}{    :param MoL\PYZus{}method: The MoL method to generate gridfunction names for.}
\PY{l+s+sd}{    :return: A tuple containing y\PYZus{}n\PYZus{}gridfunctions, non\PYZus{}y\PYZus{}n\PYZus{}gridfunctions\PYZus{}list,}
\PY{l+s+sd}{             diagnostic\PYZus{}gridfunctions\PYZus{}point\PYZus{}to, and diagnostic\PYZus{}gridfunctions2\PYZus{}point\PYZus{}to.}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{c+c1}{\PYZsh{} y\PYZus{}n\PYZus{}gridfunctions store data for the vector of gridfunctions y\PYZus{}i at t\PYZus{}n,}
    \PY{c+c1}{\PYZsh{} the start of each MoL timestep.}
    \PY{n}{y\PYZus{}n\PYZus{}gridfunctions} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{y\PYZus{}n\PYZus{}gfs}\PY{l+s+s2}{\PYZdq{}}

    \PY{c+c1}{\PYZsh{} non\PYZus{}y\PYZus{}n\PYZus{}gridfunctions are needed to compute the data at t\PYZus{}\PYZob{}n+1\PYZcb{}.}
    \PY{c+c1}{\PYZsh{} Often labeled with k\PYZus{}i in the name, these gridfunctions are *not*}
    \PY{c+c1}{\PYZsh{} needed at the start of each timestep.}
    \PY{n}{non\PYZus{}y\PYZus{}n\PYZus{}gridfunctions\PYZus{}list} \PY{o}{=} \PY{p}{[}\PY{p}{]}

    \PY{c+c1}{\PYZsh{} Diagnostic output gridfunctions diagnostic\PYZus{}output\PYZus{}gfs \PYZam{} diagnostic\PYZus{}output\PYZus{}gfs2.}
    \PY{n}{diagnostic\PYZus{}gridfunctions2\PYZus{}point\PYZus{}to} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZdq{}}

    \PY{k}{if} \PY{n}{diagonal}\PY{p}{(}\PY{n}{MoL\PYZus{}method}\PY{p}{)} \PY{o+ow}{and} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{RK3}\PY{l+s+s2}{\PYZdq{}} \PY{o+ow}{in} \PY{n}{MoL\PYZus{}method}\PY{p}{:}
        \PY{n}{non\PYZus{}y\PYZus{}n\PYZus{}gridfunctions\PYZus{}list}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{k1\PYZus{}or\PYZus{}y\PYZus{}nplus\PYZus{}a21\PYZus{}k1\PYZus{}or\PYZus{}y\PYZus{}nplus1\PYZus{}running\PYZus{}total\PYZus{}gfs}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
        \PY{n}{non\PYZus{}y\PYZus{}n\PYZus{}gridfunctions\PYZus{}list}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{k2\PYZus{}or\PYZus{}y\PYZus{}nplus\PYZus{}a32\PYZus{}k2\PYZus{}gfs}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
        \PY{n}{diagnostic\PYZus{}gridfunctions\PYZus{}point\PYZus{}to} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{k1\PYZus{}or\PYZus{}y\PYZus{}nplus\PYZus{}a21\PYZus{}k1\PYZus{}or\PYZus{}y\PYZus{}nplus1\PYZus{}running\PYZus{}total\PYZus{}gfs}\PY{l+s+s2}{\PYZdq{}}
        \PY{n}{diagnostic\PYZus{}gridfunctions2\PYZus{}point\PYZus{}to} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{k2\PYZus{}or\PYZus{}y\PYZus{}nplus\PYZus{}a32\PYZus{}k2\PYZus{}gfs}\PY{l+s+s2}{\PYZdq{}}
    \PY{k}{else}\PY{p}{:}
        \PY{k}{if} \PY{o+ow}{not} \PY{n}{diagonal}\PY{p}{(}\PY{n}{MoL\PYZus{}method}\PY{p}{)}\PY{p}{:}  \PY{c+c1}{\PYZsh{} Allocate memory for non\PYZhy{}diagonal Butcher tables}
            \PY{c+c1}{\PYZsh{} Determine the number of k\PYZus{}i steps based on length of Butcher Table}
            \PY{n}{num\PYZus{}k} \PY{o}{=} \PY{n+nb}{len}\PY{p}{(}\PY{n}{Butcher\PYZus{}dict}\PY{p}{[}\PY{n}{MoL\PYZus{}method}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}
            \PY{c+c1}{\PYZsh{} For non\PYZhy{}diagonal tables, an intermediate gridfunction \PYZdq{}next\PYZus{}y\PYZus{}input\PYZdq{} is used for rhs evaluations}
            \PY{n}{non\PYZus{}y\PYZus{}n\PYZus{}gridfunctions\PYZus{}list}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{next\PYZus{}y\PYZus{}input\PYZus{}gfs}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
            \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{num\PYZus{}k}\PY{p}{)}\PY{p}{:}  \PY{c+c1}{\PYZsh{} Need to allocate all k\PYZus{}i steps for a given method}
                \PY{n}{non\PYZus{}y\PYZus{}n\PYZus{}gridfunctions\PYZus{}list}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{k}\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{\PYZus{}gfs}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}
            \PY{n}{diagnostic\PYZus{}gridfunctions\PYZus{}point\PYZus{}to} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{k1\PYZus{}gfs}\PY{l+s+s2}{\PYZdq{}}
            \PY{k}{if} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{k2\PYZus{}gfs}\PY{l+s+s2}{\PYZdq{}} \PY{o+ow}{in} \PY{n}{non\PYZus{}y\PYZus{}n\PYZus{}gridfunctions\PYZus{}list}\PY{p}{:}
                \PY{n}{diagnostic\PYZus{}gridfunctions2\PYZus{}point\PYZus{}to} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{k2\PYZus{}gfs}\PY{l+s+s2}{\PYZdq{}}
            \PY{k}{else}\PY{p}{:}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{MoL WARNING: No gridfunction group available for diagnostic\PYZus{}output\PYZus{}gfs2}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
        \PY{k}{else}\PY{p}{:}  \PY{c+c1}{\PYZsh{} Allocate memory for diagonal Butcher tables, which use a \PYZdq{}y\PYZus{}nplus1\PYZus{}running\PYZus{}total gridfunction\PYZdq{}}
            \PY{n}{non\PYZus{}y\PYZus{}n\PYZus{}gridfunctions\PYZus{}list}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{y\PYZus{}nplus1\PYZus{}running\PYZus{}total\PYZus{}gfs}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
            \PY{k}{if} \PY{n}{MoL\PYZus{}method} \PY{o}{!=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Euler}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}  \PY{c+c1}{\PYZsh{} Allocate memory for diagonal Butcher tables that aren\PYZsq{}t Euler}
                \PY{c+c1}{\PYZsh{} Need k\PYZus{}odd for k\PYZus{}1,3,5... and k\PYZus{}even for k\PYZus{}2,4,6...}
                \PY{n}{non\PYZus{}y\PYZus{}n\PYZus{}gridfunctions\PYZus{}list}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{k\PYZus{}odd\PYZus{}gfs}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
                \PY{n}{non\PYZus{}y\PYZus{}n\PYZus{}gridfunctions\PYZus{}list}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{k\PYZus{}even\PYZus{}gfs}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
            \PY{n}{diagnostic\PYZus{}gridfunctions\PYZus{}point\PYZus{}to} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{y\PYZus{}nplus1\PYZus{}running\PYZus{}total\PYZus{}gfs}\PY{l+s+s2}{\PYZdq{}}
            \PY{n}{diagnostic\PYZus{}gridfunctions2\PYZus{}point\PYZus{}to} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{k\PYZus{}odd\PYZus{}gfs}\PY{l+s+s2}{\PYZdq{}}
    \PY{n}{non\PYZus{}y\PYZus{}n\PYZus{}gridfunctions\PYZus{}list}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{auxevol\PYZus{}gfs}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

    \PY{k}{return} \PY{n}{y\PYZus{}n\PYZus{}gridfunctions}\PY{p}{,} \PY{n}{non\PYZus{}y\PYZus{}n\PYZus{}gridfunctions\PYZus{}list}\PY{p}{,} \PYZbs{}
        \PY{n}{diagnostic\PYZus{}gridfunctions\PYZus{}point\PYZus{}to}\PY{p}{,} \PY{n}{diagnostic\PYZus{}gridfunctions2\PYZus{}point\PYZus{}to}
\end{Verbatim}
\end{tcolorbox}

    \hypertarget{step-3.b-memory-allocation-mol_malloc_y_n_gfs-and-mol_malloc_non_y_n_gfs-back-to-top}{%
\subsection{\texorpdfstring{Step 3.b: Memory allocation:
\texttt{MoL\_malloc\_y\_n\_gfs()} and
\texttt{MoL\_malloc\_non\_y\_n\_gfs()}: {[}Back to
\hyperref[toc]{top}{]}}{Step 3.b: Memory allocation: MoL\_malloc\_y\_n\_gfs() and MoL\_malloc\_non\_y\_n\_gfs(): {[}Back to {]}}}\label{step-3.b-memory-allocation-mol_malloc_y_n_gfs-and-mol_malloc_non_y_n_gfs-back-to-top}}

\[\label{alloc}\]

Generation of C functions \texttt{MoL\_malloc\_y\_n\_gfs()} and
\texttt{MoL\_malloc\_non\_y\_n\_gfs()} read the full list of needed
lists of gridfunctions, provided by (Python) function
\texttt{generate\_gridfunction\_names()}, to allocate space for all
gridfunctions.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{4}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} add\PYZus{}to\PYZus{}Cfunction\PYZus{}dict\PYZus{}MoL\PYZus{}malloc() registers}
\PY{c+c1}{\PYZsh{}           MoL\PYZus{}malloc\PYZus{}y\PYZus{}n\PYZus{}gfs() and}
\PY{c+c1}{\PYZsh{}           MoL\PYZus{}malloc\PYZus{}non\PYZus{}y\PYZus{}n\PYZus{}gfs(), which allocate memory for}
\PY{c+c1}{\PYZsh{}           the indicated sets of gridfunctions}
\PY{k}{def} \PY{n+nf}{add\PYZus{}to\PYZus{}Cfunction\PYZus{}dict\PYZus{}MoL\PYZus{}malloc}\PY{p}{(}\PY{n}{MoL\PYZus{}method}\PY{p}{,} \PY{n}{which\PYZus{}gfs}\PY{p}{)}\PY{p}{:}
    \PY{n}{includes} \PY{o}{=} \PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{NRPy\PYZus{}basic\PYZus{}defines.h}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{NRPy\PYZus{}function\PYZus{}prototypes.h}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}
    \PY{c+c1}{\PYZsh{} Create a description for the function}
    \PY{n}{desc} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Method of Lines (MoL) for }\PY{l+s+se}{\PYZbs{}\PYZdq{}}\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n}{MoL\PYZus{}method} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}\PYZdq{}}\PY{l+s+s2}{ method: Allocate memory for }\PY{l+s+se}{\PYZbs{}\PYZdq{}}\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n}{which\PYZus{}gfs} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}\PYZdq{}}\PY{l+s+s2}{ gridfunctions}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}
    \PY{n}{desc} \PY{o}{+}\PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{   * y\PYZus{}n\PYZus{}gfs are used to store data for the vector of gridfunctions y\PYZus{}i at t\PYZus{}n, at the start of each MoL timestep}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}
    \PY{n}{desc} \PY{o}{+}\PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{   * non\PYZus{}y\PYZus{}n\PYZus{}gfs are needed for intermediate (e.g., k\PYZus{}i) storage in chosen MoL method}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}
    \PY{n}{c\PYZus{}type} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{void}\PY{l+s+s2}{\PYZdq{}}

    \PY{n}{y\PYZus{}n\PYZus{}gridfunctions}\PY{p}{,} \PY{n}{non\PYZus{}y\PYZus{}n\PYZus{}gridfunctions\PYZus{}list}\PY{p}{,} \PY{n}{diagnostic\PYZus{}gridfunctions\PYZus{}point\PYZus{}to}\PY{p}{,} \PY{n}{diagnostic\PYZus{}gridfunctions2\PYZus{}point\PYZus{}to} \PY{o}{=} \PYZbs{}
        \PY{n}{generate\PYZus{}gridfunction\PYZus{}names}\PY{p}{(}\PY{n}{MoL\PYZus{}method}\PY{o}{=}\PY{n}{MoL\PYZus{}method}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Determine which gridfunctions to allocate memory for}
    \PY{k}{if} \PY{n}{which\PYZus{}gfs} \PY{o}{==} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{y\PYZus{}n\PYZus{}gfs}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:}
        \PY{n}{gridfunctions\PYZus{}list} \PY{o}{=} \PY{p}{[}\PY{n}{y\PYZus{}n\PYZus{}gridfunctions}\PY{p}{]}
    \PY{k}{elif} \PY{n}{which\PYZus{}gfs} \PY{o}{==} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{non\PYZus{}y\PYZus{}n\PYZus{}gfs}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:}
        \PY{n}{gridfunctions\PYZus{}list} \PY{o}{=} \PY{n}{non\PYZus{}y\PYZus{}n\PYZus{}gridfunctions\PYZus{}list}
    \PY{k}{else}\PY{p}{:}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ERROR: which\PYZus{}gfs = }\PY{l+s+se}{\PYZbs{}\PYZdq{}}\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n}{which\PYZus{}gfs} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}\PYZdq{}}\PY{l+s+s2}{ unrecognized.}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
        \PY{n}{sys}\PY{o}{.}\PY{n}{exit}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{)}

    \PY{n}{name} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{MoL\PYZus{}malloc\PYZus{}}\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n}{which\PYZus{}gfs}
    \PY{n}{params} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{const paramstruct *restrict params, MoL\PYZus{}gridfunctions\PYZus{}struct *restrict gridfuncs}\PY{l+s+s2}{\PYZdq{}}

    \PY{c+c1}{\PYZsh{} Generate the body of the function}
    \PY{n}{body} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{const int Nxx\PYZus{}plus\PYZus{}2NGHOSTS\PYZus{}tot = Nxx\PYZus{}plus\PYZus{}2NGHOSTS0*Nxx\PYZus{}plus\PYZus{}2NGHOSTS1*Nxx\PYZus{}plus\PYZus{}2NGHOSTS2;}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}
    \PY{k}{for} \PY{n}{gridfunctions} \PY{o+ow}{in} \PY{n}{gridfunctions\PYZus{}list}\PY{p}{:}
        \PY{n}{num\PYZus{}gfs} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{NUM\PYZus{}EVOL\PYZus{}GFS}\PY{l+s+s2}{\PYZdq{}}
        \PY{k}{if} \PY{n}{gridfunctions} \PY{o}{==} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{auxevol\PYZus{}gfs}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:}
            \PY{n}{num\PYZus{}gfs} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{NUM\PYZus{}AUXEVOL\PYZus{}GFS}\PY{l+s+s2}{\PYZdq{}}
        \PY{n}{body} \PY{o}{+}\PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{gridfuncs\PYZhy{}\PYZgt{}}\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n}{gridfunctions} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ = (REAL *restrict)malloc(sizeof(REAL) * }\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n}{num\PYZus{}gfs} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ * Nxx\PYZus{}plus\PYZus{}2NGHOSTS\PYZus{}tot);}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}
    \PY{n}{body} \PY{o}{+}\PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{gridfuncs\PYZhy{}\PYZgt{}diagnostic\PYZus{}output\PYZus{}gfs  = gridfuncs\PYZhy{}\PYZgt{}}\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n}{diagnostic\PYZus{}gridfunctions\PYZus{}point\PYZus{}to} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{;}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}
    \PY{n}{body} \PY{o}{+}\PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{gridfuncs\PYZhy{}\PYZgt{}diagnostic\PYZus{}output\PYZus{}gfs2 = gridfuncs\PYZhy{}\PYZgt{}}\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n}{diagnostic\PYZus{}gridfunctions2\PYZus{}point\PYZus{}to} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{;}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}

    \PY{c+c1}{\PYZsh{} Add the function to the C function dictionary}
    \PY{n}{add\PYZus{}to\PYZus{}Cfunction\PYZus{}dict}\PY{p}{(}
        \PY{n}{includes}\PY{o}{=}\PY{n}{includes}\PY{p}{,}
        \PY{n}{desc}\PY{o}{=}\PY{n}{desc}\PY{p}{,}
        \PY{n}{c\PYZus{}type}\PY{o}{=}\PY{n}{c\PYZus{}type}\PY{p}{,} \PY{n}{name}\PY{o}{=}\PY{n}{name}\PY{p}{,} \PY{n}{params}\PY{o}{=}\PY{n}{params}\PY{p}{,}
        \PY{n}{body}\PY{o}{=}\PY{n}{indent\PYZus{}Ccode}\PY{p}{(}\PY{n}{body}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{  }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
        \PY{n}{rel\PYZus{}path\PYZus{}to\PYZus{}Cparams}\PY{o}{=}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{.}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \hypertarget{step-3.c-take-one-method-of-lines-time-step-mol_step_forward_in_time-back-to-top}{%
\subsection{\texorpdfstring{Step 3.c: Take one Method of Lines time
step: \texttt{MoL\_step\_forward\_in\_time()} {[}Back to
\hyperref[toc]{top}{]}}{Step 3.c: Take one Method of Lines time step: MoL\_step\_forward\_in\_time() {[}Back to {]}}}\label{step-3.c-take-one-method-of-lines-time-step-mol_step_forward_in_time-back-to-top}}

\[\label{molstep}\]

An MoL step consists in general of a series of Runge-Kutta-like
substeps, and the \texttt{MoL\_step\_forward\_in\_time()} C function
pulls together all of these substeps.

The basic C code for an MoL substep, set up by the Python function
\texttt{single\_RK\_substep()} below, is as follows.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Evaluate the right-hand side of \(\partial_t \vec{f}=\) \texttt{RHS},
  to get the time derivative of the set of gridfunctions \(\vec{f}\) at
  our current time.
\item
  Perform the Runge-Kutta update, which depends on
  \(\partial_t \vec{f}\) on the current and sometimes previous times.
\item
  Call post-right-hand side functions as desired.
\end{enumerate}

The \texttt{single\_RK\_substep\_input\_symbolic()} function generates
the C code for performing the above steps, applying substitutions for
e.g., \texttt{RK\_INPUT\_GFS} and \texttt{RK\_OUTPUT\_GFS} as
appropriate. \texttt{single\_RK\_substep\_input\_symbolic()} supports
SIMD-capable code generation.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{5}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} single\PYZus{}RK\PYZus{}substep\PYZus{}input\PYZus{}symbolic() performs necessary replacements to}
\PY{c+c1}{\PYZsh{}   define C code for a single RK substep}
\PY{c+c1}{\PYZsh{}   (e.g., computing k\PYZus{}1 and then updating the outer boundaries)}
\PY{k}{def} \PY{n+nf}{single\PYZus{}RK\PYZus{}substep\PYZus{}input\PYZus{}symbolic}\PY{p}{(}\PY{n}{comment\PYZus{}block}\PY{p}{,} \PY{n}{substep\PYZus{}time\PYZus{}offset\PYZus{}dt}\PY{p}{,} \PY{n}{RHS\PYZus{}str}\PY{p}{,} \PY{n}{RHS\PYZus{}input\PYZus{}str}\PY{p}{,} \PY{n}{RHS\PYZus{}output\PYZus{}str}\PY{p}{,} \PY{n}{RK\PYZus{}lhs\PYZus{}list}\PY{p}{,} \PY{n}{RK\PYZus{}rhs\PYZus{}list}\PY{p}{,}
                                     \PY{n}{post\PYZus{}RHS\PYZus{}list}\PY{p}{,} \PY{n}{post\PYZus{}RHS\PYZus{}output\PYZus{}list}\PY{p}{,} \PY{n}{enable\PYZus{}SIMD}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
                                     \PY{n}{gf\PYZus{}aliases}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{post\PYZus{}post\PYZus{}RHS\PYZus{}string}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{:}
    \PY{n}{return\PYZus{}str} \PY{o}{=} \PY{n}{comment\PYZus{}block} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}
    \PY{n}{substep\PYZus{}time\PYZus{}offset\PYZus{}str} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+si}{\PYZob{}:.17e\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n+nb}{float}\PY{p}{(}\PY{n}{substep\PYZus{}time\PYZus{}offset\PYZus{}dt}\PY{p}{)}\PY{p}{)}
    \PY{n}{return\PYZus{}str} \PY{o}{+}\PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{griddata\PYZhy{}\PYZgt{}params.time = time\PYZus{}start + }\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n}{substep\PYZus{}time\PYZus{}offset\PYZus{}str} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ * griddata\PYZhy{}\PYZgt{}params.dt;}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}

    \PY{c+c1}{\PYZsh{} Ensure all input lists are lists}
    \PY{n}{RK\PYZus{}lhs\PYZus{}list} \PY{o}{=} \PY{p}{[}\PY{n}{RK\PYZus{}lhs\PYZus{}list}\PY{p}{]} \PY{k}{if} \PY{o+ow}{not} \PY{n+nb}{isinstance}\PY{p}{(}\PY{n}{RK\PYZus{}lhs\PYZus{}list}\PY{p}{,} \PY{n+nb}{list}\PY{p}{)} \PY{k}{else} \PY{n}{RK\PYZus{}lhs\PYZus{}list}
    \PY{n}{RK\PYZus{}rhs\PYZus{}list} \PY{o}{=} \PY{p}{[}\PY{n}{RK\PYZus{}rhs\PYZus{}list}\PY{p}{]} \PY{k}{if} \PY{o+ow}{not} \PY{n+nb}{isinstance}\PY{p}{(}\PY{n}{RK\PYZus{}rhs\PYZus{}list}\PY{p}{,} \PY{n+nb}{list}\PY{p}{)} \PY{k}{else} \PY{n}{RK\PYZus{}rhs\PYZus{}list}
    \PY{n}{post\PYZus{}RHS\PYZus{}list} \PY{o}{=} \PY{p}{[}\PY{n}{post\PYZus{}RHS\PYZus{}list}\PY{p}{]} \PY{k}{if} \PY{o+ow}{not} \PY{n+nb}{isinstance}\PY{p}{(}\PY{n}{post\PYZus{}RHS\PYZus{}list}\PY{p}{,} \PY{n+nb}{list}\PY{p}{)} \PY{k}{else} \PY{n}{post\PYZus{}RHS\PYZus{}list}
    \PY{n}{post\PYZus{}RHS\PYZus{}output\PYZus{}list} \PY{o}{=} \PY{p}{[}\PY{n}{post\PYZus{}RHS\PYZus{}output\PYZus{}list}\PY{p}{]} \PY{k}{if} \PY{o+ow}{not} \PY{n+nb}{isinstance}\PY{p}{(}\PY{n}{post\PYZus{}RHS\PYZus{}output\PYZus{}list}\PY{p}{,} \PY{n+nb}{list}\PY{p}{)} \PY{k}{else} \PY{n}{post\PYZus{}RHS\PYZus{}output\PYZus{}list}

    \PY{n}{return\PYZus{}str} \PY{o}{+}\PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZob{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n}{indent\PYZus{}Ccode}\PY{p}{(}\PY{n}{gf\PYZus{}aliases}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{  }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n}{indent} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{  }\PY{l+s+s2}{\PYZdq{}}

    \PY{c+c1}{\PYZsh{} Part 1: RHS evaluation}
    \PY{n}{return\PYZus{}str} \PY{o}{+}\PY{o}{=} \PY{n}{indent\PYZus{}Ccode}\PY{p}{(}\PY{n+nb}{str}\PY{p}{(}\PY{n}{RHS\PYZus{}str}\PY{p}{)}\PY{o}{.}\PY{n}{replace}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{RK\PYZus{}INPUT\PYZus{}GFS}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}  \PY{n+nb}{str}\PY{p}{(}\PY{n}{RHS\PYZus{}input\PYZus{}str}\PY{p}{)}\PY{o}{.}\PY{n}{replace}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{gfsL}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{gfs}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{o}{.}
                               \PY{n}{replace}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{RK\PYZus{}OUTPUT\PYZus{}GFS}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n+nb}{str}\PY{p}{(}\PY{n}{RHS\PYZus{}output\PYZus{}str}\PY{p}{)}\PY{o}{.}\PY{n}{replace}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{gfsL}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{gfs}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{indent}\PY{o}{=}\PY{n}{indent}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Part 2: RK update}
    \PY{k}{if} \PY{n}{enable\PYZus{}SIMD}\PY{p}{:}
        \PY{n}{return\PYZus{}str} \PY{o}{+}\PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZsh{}pragma omp parallel for}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}
        \PY{n}{return\PYZus{}str} \PY{o}{+}\PY{o}{=} \PY{n}{indent} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{for(int i=0;i\PYZlt{}Nxx\PYZus{}plus\PYZus{}2NGHOSTS0*Nxx\PYZus{}plus\PYZus{}2NGHOSTS1*Nxx\PYZus{}plus\PYZus{}2NGHOSTS2*NUM\PYZus{}EVOL\PYZus{}GFS;i+=SIMD\PYZus{}width) }\PY{l+s+s2}{\PYZob{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}
    \PY{k}{else}\PY{p}{:}
        \PY{n}{return\PYZus{}str} \PY{o}{+}\PY{o}{=} \PY{n}{indent} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{LOOP\PYZus{}ALL\PYZus{}GFS\PYZus{}GPS(i) }\PY{l+s+s2}{\PYZob{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}

    \PY{n}{var\PYZus{}type} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{REAL\PYZus{}SIMD\PYZus{}ARRAY}\PY{l+s+s2}{\PYZdq{}} \PY{k}{if} \PY{n}{enable\PYZus{}SIMD} \PY{k}{else} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{REAL}\PY{l+s+s2}{\PYZdq{}}
    \PY{n}{RK\PYZus{}lhs\PYZus{}str\PYZus{}list} \PY{o}{=} \PY{p}{[}\PY{n}{indent} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{const REAL\PYZus{}SIMD\PYZus{}ARRAY \PYZus{}\PYZus{}RHS\PYZus{}exp\PYZus{}}\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{i}\PY{p}{)} \PY{k}{if} \PY{n}{enable\PYZus{}SIMD} \PY{k}{else} \PY{n}{indent} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{el}\PY{p}{)}\PY{o}{.}\PY{n}{replace}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{gfsL}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{gfs[i]}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)} \PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{el} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{RK\PYZus{}lhs\PYZus{}list}\PY{p}{)}\PY{p}{]}

    \PY{n}{read\PYZus{}list} \PY{o}{=} \PY{p}{[}\PY{n}{read} \PY{k}{for} \PY{n}{el} \PY{o+ow}{in} \PY{n}{RK\PYZus{}rhs\PYZus{}list} \PY{k}{for} \PY{n}{read} \PY{o+ow}{in} \PY{n+nb}{list}\PY{p}{(}\PY{n}{sp}\PY{o}{.}\PY{n}{ordered}\PY{p}{(}\PY{n}{el}\PY{o}{.}\PY{n}{free\PYZus{}symbols}\PY{p}{)}\PY{p}{)}\PY{p}{]}
    \PY{n}{read\PYZus{}list\PYZus{}unique} \PY{o}{=} \PY{n}{superfast\PYZus{}uniq}\PY{p}{(}\PY{n}{read\PYZus{}list}\PY{p}{)}

    \PY{k}{for} \PY{n}{el} \PY{o+ow}{in} \PY{n}{read\PYZus{}list\PYZus{}unique}\PY{p}{:}
        \PY{k}{if} \PY{n+nb}{str}\PY{p}{(}\PY{n}{el}\PY{p}{)} \PY{o}{!=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{params\PYZhy{}\PYZgt{}dt}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:}
            \PY{k}{if} \PY{n}{enable\PYZus{}SIMD}\PY{p}{:}
                \PY{n}{simd\PYZus{}el} \PY{o}{=} \PY{n+nb}{str}\PY{p}{(}\PY{n}{el}\PY{p}{)}\PY{o}{.}\PY{n}{replace}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{gfsL}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{gfs[i]}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
                \PY{n}{return\PYZus{}str} \PY{o}{+}\PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{  const }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{ }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{ = ReadSIMD(\PYZam{}}\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{);}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{indent}\PY{p}{,} \PY{n}{var\PYZus{}type}\PY{p}{,} \PY{n+nb}{str}\PY{p}{(}\PY{n}{el}\PY{p}{)}\PY{p}{,} \PY{n}{simd\PYZus{}el}\PY{p}{)}
            \PY{k}{else}\PY{p}{:}
                \PY{n}{return\PYZus{}str} \PY{o}{+}\PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{  const }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{ }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{ = }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{;}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{indent}\PY{p}{,} \PY{n}{var\PYZus{}type}\PY{p}{,} \PY{n+nb}{str}\PY{p}{(}\PY{n}{el}\PY{p}{)}\PY{p}{,}
                                                               \PY{n+nb}{str}\PY{p}{(}\PY{n}{el}\PY{p}{)}\PY{o}{.}\PY{n}{replace}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{gfsL}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{gfs[i]}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}

    \PY{k}{if} \PY{n}{enable\PYZus{}SIMD}\PY{p}{:}
        \PY{n}{return\PYZus{}str} \PY{o}{+}\PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s2}{  const REAL\PYZus{}SIMD\PYZus{}ARRAY DT = ConstSIMD(params\PYZhy{}\PYZgt{}dt);}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{indent}\PY{p}{)}

    \PY{n}{pre\PYZus{}indent} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{2}\PY{l+s+s2}{\PYZdq{}}
    \PY{n}{kernel} \PY{o}{=} \PY{n}{outputC}\PY{p}{(}\PY{n}{RK\PYZus{}rhs\PYZus{}list}\PY{p}{,} \PY{n}{RK\PYZus{}lhs\PYZus{}str\PYZus{}list}\PY{p}{,} \PY{n}{filename}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{returnstring}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
                     \PY{n}{params}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{includebraces=False,preindent=}\PY{l+s+s2}{\PYZdq{}}\PY{o}{+}\PY{n}{pre\PYZus{}indent}\PY{o}{+}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{,outCverbose=False,enable\PYZus{}SIMD=}\PY{l+s+s2}{\PYZdq{}}\PY{o}{+}\PY{n+nb}{str}\PY{p}{(}\PY{n}{enable\PYZus{}SIMD}\PY{p}{)}\PY{p}{)}
    \PY{k}{if} \PY{n}{enable\PYZus{}SIMD}\PY{p}{:}
        \PY{n}{return\PYZus{}str} \PY{o}{+}\PY{o}{=} \PY{n}{kernel}\PY{o}{.}\PY{n}{replace}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{params\PYZhy{}\PYZgt{}dt}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{DT}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
        \PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{el} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{RK\PYZus{}lhs\PYZus{}list}\PY{p}{)}\PY{p}{:}
            \PY{n}{return\PYZus{}str} \PY{o}{+}\PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{  WriteSIMD(\PYZam{}}\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{el}\PY{p}{)}\PY{o}{.}\PY{n}{replace}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{gfsL}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{gfs[i]}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{, \PYZus{}\PYZus{}RHS\PYZus{}exp\PYZus{}}\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{i}\PY{p}{)} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{);}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}
    \PY{k}{else}\PY{p}{:}
        \PY{n}{return\PYZus{}str} \PY{o}{+}\PY{o}{=} \PY{n}{kernel}

    \PY{n}{return\PYZus{}str} \PY{o}{+}\PY{o}{=} \PY{n}{indent} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZcb{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}

    \PY{c+c1}{\PYZsh{} Part 3: Call post\PYZhy{}RHS functions}
    \PY{k}{for} \PY{n}{post\PYZus{}RHS}\PY{p}{,} \PY{n}{post\PYZus{}RHS\PYZus{}output} \PY{o+ow}{in} \PY{n+nb}{zip}\PY{p}{(}\PY{n}{post\PYZus{}RHS\PYZus{}list}\PY{p}{,} \PY{n}{post\PYZus{}RHS\PYZus{}output\PYZus{}list}\PY{p}{)}\PY{p}{:}
        \PY{n}{return\PYZus{}str} \PY{o}{+}\PY{o}{=} \PY{n}{indent\PYZus{}Ccode}\PY{p}{(}\PY{n}{post\PYZus{}RHS}\PY{o}{.}\PY{n}{replace}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{RK\PYZus{}OUTPUT\PYZus{}GFS}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n+nb}{str}\PY{p}{(}\PY{n}{post\PYZus{}RHS\PYZus{}output}\PY{p}{)}\PY{o}{.}\PY{n}{replace}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{gfsL}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{gfs}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}

    \PY{n}{return\PYZus{}str} \PY{o}{+}\PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZcb{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}

    \PY{k}{for} \PY{n}{post\PYZus{}RHS}\PY{p}{,} \PY{n}{post\PYZus{}RHS\PYZus{}output} \PY{o+ow}{in} \PY{n+nb}{zip}\PY{p}{(}\PY{n}{post\PYZus{}RHS\PYZus{}list}\PY{p}{,} \PY{n}{post\PYZus{}RHS\PYZus{}output\PYZus{}list}\PY{p}{)}\PY{p}{:}
        \PY{n}{return\PYZus{}str} \PY{o}{+}\PY{o}{=} \PY{n}{indent\PYZus{}Ccode}\PY{p}{(}\PY{n}{post\PYZus{}post\PYZus{}RHS\PYZus{}string}\PY{o}{.}\PY{n}{replace}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{RK\PYZus{}OUTPUT\PYZus{}GFS}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n+nb}{str}\PY{p}{(}\PY{n}{post\PYZus{}RHS\PYZus{}output}\PY{p}{)}\PY{o}{.}\PY{n}{replace}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{gfsL}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{gfs}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

    \PY{k}{return} \PY{n}{return\PYZus{}str}
\end{Verbatim}
\end{tcolorbox}

    In the \texttt{add\_to\_Cfunction\_dict\_MoL\_step\_forward\_in\_time()}
Python function below, we construct and register the core C function for
MoL timestepping: \texttt{MoL\_step\_forward\_in\_time()}.
\texttt{MoL\_step\_forward\_in\_time()} implements Butcher tables for
Runge-Kutta-like methods, leveraging the \texttt{single\_RK\_substep()}
helper function above as needed. Again, we aim for maximum memory
efficiency so that, e.g., RK4 needs to store only 4 levels of
\(\vec{f}\).

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{6}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def} \PY{n+nf}{add\PYZus{}to\PYZus{}Cfunction\PYZus{}dict\PYZus{}MoL\PYZus{}step\PYZus{}forward\PYZus{}in\PYZus{}time}\PY{p}{(}\PY{n}{MoL\PYZus{}method}\PY{p}{,}
                                                   \PY{n}{RHS\PYZus{}string} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{post\PYZus{}RHS\PYZus{}string} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{post\PYZus{}post\PYZus{}RHS\PYZus{}string}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
                                                   \PY{n}{enable\PYZus{}rfm}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,} \PY{n}{enable\PYZus{}curviBCs}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,} \PY{n}{enable\PYZus{}SIMD}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}\PY{p}{:}
    \PY{n}{includes} \PY{o}{=} \PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{NRPy\PYZus{}basic\PYZus{}defines.h}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{NRPy\PYZus{}function\PYZus{}prototypes.h}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}
    \PY{k}{if} \PY{n}{enable\PYZus{}SIMD}\PY{p}{:}
        \PY{n}{includes} \PY{o}{+}\PY{o}{=} \PY{p}{[}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{SIMD}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{SIMD\PYZus{}intrinsics.h}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{]}
    \PY{n}{desc}  \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Method of Lines (MoL) for }\PY{l+s+se}{\PYZbs{}\PYZdq{}}\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n}{MoL\PYZus{}method} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}\PYZdq{}}\PY{l+s+s2}{ method: Step forward one full timestep.}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}
    \PY{n}{c\PYZus{}type} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{void}\PY{l+s+s2}{\PYZdq{}}
    \PY{n}{name} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{MoL\PYZus{}step\PYZus{}forward\PYZus{}in\PYZus{}time}\PY{l+s+s2}{\PYZdq{}}
    \PY{n}{params} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{griddata\PYZus{}struct *restrict griddata}\PY{l+s+s2}{\PYZdq{}}

    \PY{n}{indent} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZdq{}}  \PY{c+c1}{\PYZsh{} We don\PYZsq{}t bother with an indent here.}

    \PY{n}{body} \PY{o}{=} \PY{n}{indent} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{// C code implementation of \PYZhy{}=}\PY{l+s+s2}{\PYZob{}}\PY{l+s+s2}{ }\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n}{MoL\PYZus{}method} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ \PYZcb{}=\PYZhy{} Method of Lines timestepping.}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}
    \PY{n}{body} \PY{o}{+}\PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{// First set the initial time:}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}
    \PY{n}{body} \PY{o}{+}\PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{const REAL time\PYZus{}start = griddata\PYZhy{}\PYZgt{}params.time;}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}

    \PY{n}{y\PYZus{}n\PYZus{}gridfunctions}\PY{p}{,} \PY{n}{non\PYZus{}y\PYZus{}n\PYZus{}gridfunctions\PYZus{}list}\PY{p}{,} \PY{n}{\PYZus{}throwaway}\PY{p}{,} \PY{n}{\PYZus{}throwaway2} \PY{o}{=} \PY{n}{generate\PYZus{}gridfunction\PYZus{}names}\PY{p}{(}\PY{n}{MoL\PYZus{}method}\PY{p}{)}

    \PY{n}{gf\PYZus{}prefix} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{griddata\PYZhy{}\PYZgt{}gridfuncs.}\PY{l+s+s2}{\PYZdq{}}

    \PY{n}{gf\PYZus{}aliases} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}\PYZdq{}\PYZdq{}}\PY{l+s+s2}{// Set gridfunction aliases from gridfuncs struct}
\PY{l+s+s2}{REAL *restrict }\PY{l+s+s2}{\PYZdq{}\PYZdq{}\PYZdq{}} \PY{o}{+} \PY{n}{y\PYZus{}n\PYZus{}gridfunctions} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ = }\PY{l+s+s2}{\PYZdq{}}\PY{o}{+}\PY{n}{gf\PYZus{}prefix} \PY{o}{+} \PY{n}{y\PYZus{}n\PYZus{}gridfunctions} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}\PYZdq{}\PYZdq{}}\PY{l+s+s2}{;  // y\PYZus{}n gridfunctions}
\PY{l+s+s2}{// Temporary timelevel \PYZam{} AUXEVOL gridfunctions:}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{k}{for} \PY{n}{gf} \PY{o+ow}{in} \PY{n}{non\PYZus{}y\PYZus{}n\PYZus{}gridfunctions\PYZus{}list}\PY{p}{:}
        \PY{n}{gf\PYZus{}aliases} \PY{o}{+}\PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{REAL *restrict }\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n}{gf} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ = }\PY{l+s+s2}{\PYZdq{}}\PY{o}{+}\PY{n}{gf\PYZus{}prefix} \PY{o}{+} \PY{n}{gf} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{;}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}

    \PY{n}{gf\PYZus{}aliases} \PY{o}{+}\PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{paramstruct *restrict params = \PYZam{}griddata\PYZhy{}\PYZgt{}params;}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}
    \PY{k}{if} \PY{n}{enable\PYZus{}rfm}\PY{p}{:}
        \PY{n}{gf\PYZus{}aliases} \PY{o}{+}\PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{const rfm\PYZus{}struct *restrict rfmstruct = \PYZam{}griddata\PYZhy{}\PYZgt{}rfmstruct;}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}
    \PY{k}{else}\PY{p}{:}
        \PY{n}{gf\PYZus{}aliases} \PY{o}{+}\PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{REAL *restrict xx[3]; for(int ww=0;ww\PYZlt{}3;ww++) xx[ww] = griddata\PYZhy{}\PYZgt{}xx[ww];}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}
    \PY{k}{if} \PY{n}{enable\PYZus{}curviBCs}\PY{p}{:}
        \PY{n}{gf\PYZus{}aliases} \PY{o}{+}\PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{const bc\PYZus{}struct *restrict bcstruct = \PYZam{}griddata\PYZhy{}\PYZgt{}bcstruct;}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}
    \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{0}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{1}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{2}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{:}
        \PY{n}{gf\PYZus{}aliases} \PY{o}{+}\PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{const int Nxx\PYZus{}plus\PYZus{}2NGHOSTS}\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n}{i} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ = griddata\PYZhy{}\PYZgt{}params.Nxx\PYZus{}plus\PYZus{}2NGHOSTS}\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n}{i} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{;}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}

    \PY{c+c1}{\PYZsh{} Implement Method of Lines (MoL) Timestepping}
    \PY{n}{Butcher} \PY{o}{=} \PY{n}{Butcher\PYZus{}dict}\PY{p}{[}\PY{n}{MoL\PYZus{}method}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}  \PY{c+c1}{\PYZsh{} Get the desired Butcher table from the dictionary}
    \PY{n}{num\PYZus{}steps} \PY{o}{=} \PY{n+nb}{len}\PY{p}{(}\PY{n}{Butcher}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}  \PY{c+c1}{\PYZsh{} Specify the number of required steps to update solution}

    \PY{n}{dt} \PY{o}{=} \PY{n}{sp}\PY{o}{.}\PY{n}{Symbol}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{params\PYZhy{}\PYZgt{}dt}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{real}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}

    \PY{k}{if} \PY{n}{diagonal}\PY{p}{(}\PY{n}{MoL\PYZus{}method}\PY{p}{)} \PY{o+ow}{and} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{RK3}\PY{l+s+s2}{\PYZdq{}} \PY{o+ow}{in} \PY{n}{MoL\PYZus{}method}\PY{p}{:}
        \PY{c+c1}{\PYZsh{} Diagonal RK3 only!!!}
        \PY{c+c1}{\PYZsh{}  In a diagonal RK3 method, only 3 gridfunctions need be defined. Below implements this approach.}
        \PY{n}{y\PYZus{}n\PYZus{}gfs} \PY{o}{=} \PY{n}{sp}\PY{o}{.}\PY{n}{Symbol}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{y\PYZus{}n\PYZus{}gfsL}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{real}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
        \PY{n}{k1\PYZus{}or\PYZus{}y\PYZus{}nplus\PYZus{}a21\PYZus{}k1\PYZus{}or\PYZus{}y\PYZus{}nplus1\PYZus{}running\PYZus{}total\PYZus{}gfs} \PY{o}{=} \PY{n}{sp}\PY{o}{.}\PY{n}{Symbol}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{k1\PYZus{}or\PYZus{}y\PYZus{}nplus\PYZus{}a21\PYZus{}k1\PYZus{}or\PYZus{}y\PYZus{}nplus1\PYZus{}running\PYZus{}total\PYZus{}gfsL}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{real}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
        \PY{n}{k2\PYZus{}or\PYZus{}y\PYZus{}nplus\PYZus{}a32\PYZus{}k2\PYZus{}gfs} \PY{o}{=} \PY{n}{sp}\PY{o}{.}\PY{n}{Symbol}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{k2\PYZus{}or\PYZus{}y\PYZus{}nplus\PYZus{}a32\PYZus{}k2\PYZus{}gfsL}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{real}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
        \PY{c+c1}{\PYZsh{} k\PYZus{}1}
        \PY{n}{body} \PY{o}{+}\PY{o}{=} \PY{l+s+s2}{\PYZdq{}\PYZdq{}\PYZdq{}}
\PY{l+s+s2}{    // In a diagonal RK3 method like this one, only 3 gridfunctions need be defined. Below implements this approach.}
\PY{l+s+s2}{    // Using y\PYZus{}n\PYZus{}gfs as input, k1 and apply boundary conditions}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}\PYZdq{}\PYZdq{}}
        \PY{n}{body} \PY{o}{+}\PY{o}{=} \PY{n}{single\PYZus{}RK\PYZus{}substep\PYZus{}input\PYZus{}symbolic}\PY{p}{(}
            \PY{n}{comment\PYZus{}block}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}\PYZdq{}\PYZdq{}}\PY{l+s+s2}{// \PYZhy{}=}\PY{l+s+s2}{\PYZob{}}\PY{l+s+s2}{ START k1 substep \PYZcb{}=\PYZhy{}}
\PY{l+s+s2}{    // RHS evaluation:}
\PY{l+s+s2}{    //  1. We will store k1\PYZus{}or\PYZus{}y\PYZus{}nplus\PYZus{}a21\PYZus{}k1\PYZus{}or\PYZus{}y\PYZus{}nplus1\PYZus{}running\PYZus{}total\PYZus{}gfs now as}
\PY{l+s+s2}{    //     ...  the update for the next rhs evaluation y\PYZus{}n + a21*k1*dt}
\PY{l+s+s2}{    // Post\PYZhy{}RHS evaluation:}
\PY{l+s+s2}{    //  1. Apply post\PYZhy{}RHS to y\PYZus{}n + a21*k1*dt}\PY{l+s+s2}{\PYZdq{}\PYZdq{}\PYZdq{}}\PY{p}{,}
            \PY{n}{substep\PYZus{}time\PYZus{}offset\PYZus{}dt}\PY{o}{=}\PY{n}{Butcher}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,}
            \PY{n}{RHS\PYZus{}str}\PY{o}{=}\PY{n}{RHS\PYZus{}string}\PY{p}{,}
            \PY{n}{RHS\PYZus{}input\PYZus{}str}\PY{o}{=}\PY{n}{y\PYZus{}n\PYZus{}gfs}\PY{p}{,}
            \PY{n}{RHS\PYZus{}output\PYZus{}str}\PY{o}{=}\PY{n}{k1\PYZus{}or\PYZus{}y\PYZus{}nplus\PYZus{}a21\PYZus{}k1\PYZus{}or\PYZus{}y\PYZus{}nplus1\PYZus{}running\PYZus{}total\PYZus{}gfs}\PY{p}{,}
            \PY{n}{RK\PYZus{}lhs\PYZus{}list}\PY{o}{=}\PY{p}{[}\PY{n}{k1\PYZus{}or\PYZus{}y\PYZus{}nplus\PYZus{}a21\PYZus{}k1\PYZus{}or\PYZus{}y\PYZus{}nplus1\PYZus{}running\PYZus{}total\PYZus{}gfs}\PY{p}{]}\PY{p}{,}
            \PY{n}{RK\PYZus{}rhs\PYZus{}list}\PY{o}{=}\PY{p}{[}\PY{n}{Butcher}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{*}\PY{n}{k1\PYZus{}or\PYZus{}y\PYZus{}nplus\PYZus{}a21\PYZus{}k1\PYZus{}or\PYZus{}y\PYZus{}nplus1\PYZus{}running\PYZus{}total\PYZus{}gfs}\PY{o}{*}\PY{n}{dt} \PY{o}{+} \PY{n}{y\PYZus{}n\PYZus{}gfs}\PY{p}{]}\PY{p}{,}
            \PY{n}{post\PYZus{}RHS\PYZus{}list}\PY{o}{=}\PY{p}{[}\PY{n}{post\PYZus{}RHS\PYZus{}string}\PY{p}{]}\PY{p}{,} \PY{n}{post\PYZus{}RHS\PYZus{}output\PYZus{}list}\PY{o}{=}\PY{p}{[}\PY{n}{k1\PYZus{}or\PYZus{}y\PYZus{}nplus\PYZus{}a21\PYZus{}k1\PYZus{}or\PYZus{}y\PYZus{}nplus1\PYZus{}running\PYZus{}total\PYZus{}gfs}\PY{p}{]}\PY{p}{,}
            \PY{n}{enable\PYZus{}SIMD}\PY{o}{=}\PY{n}{enable\PYZus{}SIMD}\PY{p}{,} \PY{n}{gf\PYZus{}aliases}\PY{o}{=}\PY{n}{gf\PYZus{}aliases}\PY{p}{,}
            \PY{n}{post\PYZus{}post\PYZus{}RHS\PYZus{}string}\PY{o}{=}\PY{n}{post\PYZus{}post\PYZus{}RHS\PYZus{}string}\PY{p}{)} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{// \PYZhy{}=}\PY{l+s+s2}{\PYZob{}}\PY{l+s+s2}{ END k1 substep \PYZcb{}=\PYZhy{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}

        \PY{c+c1}{\PYZsh{} k\PYZus{}2}
        \PY{n}{body} \PY{o}{+}\PY{o}{=} \PY{n}{single\PYZus{}RK\PYZus{}substep\PYZus{}input\PYZus{}symbolic}\PY{p}{(}
            \PY{n}{comment\PYZus{}block}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}\PYZdq{}\PYZdq{}}\PY{l+s+s2}{// \PYZhy{}=}\PY{l+s+s2}{\PYZob{}}\PY{l+s+s2}{ START k2 substep \PYZcb{}=\PYZhy{}}
\PY{l+s+s2}{    // RHS evaluation:}
\PY{l+s+s2}{    //    1. Reassign k1\PYZus{}or\PYZus{}y\PYZus{}nplus\PYZus{}a21\PYZus{}k1\PYZus{}or\PYZus{}y\PYZus{}nplus1\PYZus{}running\PYZus{}total\PYZus{}gfs to be the running total y\PYZus{}}\PY{l+s+s2}{\PYZob{}}\PY{l+s+s2}{n+1\PYZcb{}; a32*k2*dt to the running total}
\PY{l+s+s2}{    //    2. Store k2\PYZus{}or\PYZus{}y\PYZus{}nplus\PYZus{}a32\PYZus{}k2\PYZus{}gfs now as y\PYZus{}n + a32*k2*dt}
\PY{l+s+s2}{    // Post\PYZhy{}RHS evaluation:}
\PY{l+s+s2}{    //    1. Apply post\PYZhy{}RHS to both y\PYZus{}n + a32*k2 (stored in k2\PYZus{}or\PYZus{}y\PYZus{}nplus\PYZus{}a32\PYZus{}k2\PYZus{}gfs)}
\PY{l+s+s2}{    //       ... and the y\PYZus{}}\PY{l+s+s2}{\PYZob{}}\PY{l+s+s2}{n+1\PYZcb{} running total, as they have not been applied yet to k2\PYZhy{}related gridfunctions}\PY{l+s+s2}{\PYZdq{}\PYZdq{}\PYZdq{}}\PY{p}{,}
            \PY{n}{RHS\PYZus{}str}\PY{o}{=}\PY{n}{RHS\PYZus{}string}\PY{p}{,}
            \PY{n}{substep\PYZus{}time\PYZus{}offset\PYZus{}dt}\PY{o}{=}\PY{n}{Butcher}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,}
            \PY{n}{RHS\PYZus{}input\PYZus{}str}\PY{o}{=}\PY{n}{k1\PYZus{}or\PYZus{}y\PYZus{}nplus\PYZus{}a21\PYZus{}k1\PYZus{}or\PYZus{}y\PYZus{}nplus1\PYZus{}running\PYZus{}total\PYZus{}gfs}\PY{p}{,}
            \PY{n}{RHS\PYZus{}output\PYZus{}str}\PY{o}{=}\PY{n}{k2\PYZus{}or\PYZus{}y\PYZus{}nplus\PYZus{}a32\PYZus{}k2\PYZus{}gfs}\PY{p}{,}
            \PY{n}{RK\PYZus{}lhs\PYZus{}list}\PY{o}{=}\PY{p}{[}\PY{n}{k1\PYZus{}or\PYZus{}y\PYZus{}nplus\PYZus{}a21\PYZus{}k1\PYZus{}or\PYZus{}y\PYZus{}nplus1\PYZus{}running\PYZus{}total\PYZus{}gfs}\PY{p}{,} \PY{n}{k2\PYZus{}or\PYZus{}y\PYZus{}nplus\PYZus{}a32\PYZus{}k2\PYZus{}gfs}\PY{p}{]}\PY{p}{,}
            \PY{n}{RK\PYZus{}rhs\PYZus{}list}\PY{o}{=}\PY{p}{[}\PY{n}{Butcher}\PY{p}{[}\PY{l+m+mi}{3}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{*}\PY{p}{(}\PY{n}{k1\PYZus{}or\PYZus{}y\PYZus{}nplus\PYZus{}a21\PYZus{}k1\PYZus{}or\PYZus{}y\PYZus{}nplus1\PYZus{}running\PYZus{}total\PYZus{}gfs} \PY{o}{\PYZhy{}} \PY{n}{y\PYZus{}n\PYZus{}gfs}\PY{p}{)}\PY{o}{/}\PY{n}{Butcher}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{+} \PY{n}{y\PYZus{}n\PYZus{}gfs} \PY{o}{+} \PY{n}{Butcher}\PY{p}{[}\PY{l+m+mi}{3}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}\PY{o}{*}\PY{n}{k2\PYZus{}or\PYZus{}y\PYZus{}nplus\PYZus{}a32\PYZus{}k2\PYZus{}gfs}\PY{o}{*}\PY{n}{dt}\PY{p}{,}
                          \PY{n}{Butcher}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}\PY{o}{*}\PY{n}{k2\PYZus{}or\PYZus{}y\PYZus{}nplus\PYZus{}a32\PYZus{}k2\PYZus{}gfs}\PY{o}{*}\PY{n}{dt} \PY{o}{+} \PY{n}{y\PYZus{}n\PYZus{}gfs}\PY{p}{]}\PY{p}{,}
            \PY{n}{post\PYZus{}RHS\PYZus{}list}\PY{o}{=}\PY{p}{[}\PY{n}{post\PYZus{}RHS\PYZus{}string}\PY{p}{,} \PY{n}{post\PYZus{}RHS\PYZus{}string}\PY{p}{]}\PY{p}{,}
            \PY{n}{post\PYZus{}RHS\PYZus{}output\PYZus{}list}\PY{o}{=}\PY{p}{[}\PY{n}{k2\PYZus{}or\PYZus{}y\PYZus{}nplus\PYZus{}a32\PYZus{}k2\PYZus{}gfs}\PY{p}{,}
                                  \PY{n}{k1\PYZus{}or\PYZus{}y\PYZus{}nplus\PYZus{}a21\PYZus{}k1\PYZus{}or\PYZus{}y\PYZus{}nplus1\PYZus{}running\PYZus{}total\PYZus{}gfs}\PY{p}{]}\PY{p}{,}
            \PY{n}{enable\PYZus{}SIMD}\PY{o}{=}\PY{n}{enable\PYZus{}SIMD}\PY{p}{,} \PY{n}{gf\PYZus{}aliases}\PY{o}{=}\PY{n}{gf\PYZus{}aliases}\PY{p}{,}
            \PY{n}{post\PYZus{}post\PYZus{}RHS\PYZus{}string}\PY{o}{=}\PY{n}{post\PYZus{}post\PYZus{}RHS\PYZus{}string}\PY{p}{)} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{// \PYZhy{}=}\PY{l+s+s2}{\PYZob{}}\PY{l+s+s2}{ END k2 substep \PYZcb{}=\PYZhy{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}

        \PY{c+c1}{\PYZsh{} k\PYZus{}3}
        \PY{n}{body} \PY{o}{+}\PY{o}{=} \PY{n}{single\PYZus{}RK\PYZus{}substep\PYZus{}input\PYZus{}symbolic}\PY{p}{(}
            \PY{n}{comment\PYZus{}block}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}\PYZdq{}\PYZdq{}}\PY{l+s+s2}{// \PYZhy{}=}\PY{l+s+s2}{\PYZob{}}\PY{l+s+s2}{ START k3 substep \PYZcb{}=\PYZhy{}}
\PY{l+s+s2}{        // RHS evaluation:}
\PY{l+s+s2}{        //    1. Add k3 to the running total and save to y\PYZus{}n}
\PY{l+s+s2}{        // Post\PYZhy{}RHS evaluation:}
\PY{l+s+s2}{        //    1. Apply post\PYZhy{}RHS to y\PYZus{}n}\PY{l+s+s2}{\PYZdq{}\PYZdq{}\PYZdq{}}\PY{p}{,}
            \PY{n}{substep\PYZus{}time\PYZus{}offset\PYZus{}dt}\PY{o}{=}\PY{n}{Butcher}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,}
            \PY{n}{RHS\PYZus{}str}\PY{o}{=}\PY{n}{RHS\PYZus{}string}\PY{p}{,}
            \PY{n}{RHS\PYZus{}input\PYZus{}str}\PY{o}{=}\PY{n}{k2\PYZus{}or\PYZus{}y\PYZus{}nplus\PYZus{}a32\PYZus{}k2\PYZus{}gfs}\PY{p}{,} \PY{n}{RHS\PYZus{}output\PYZus{}str}\PY{o}{=}\PY{n}{y\PYZus{}n\PYZus{}gfs}\PY{p}{,}
            \PY{n}{RK\PYZus{}lhs\PYZus{}list}\PY{o}{=}\PY{p}{[}\PY{n}{y\PYZus{}n\PYZus{}gfs}\PY{p}{]}\PY{p}{,}
            \PY{n}{RK\PYZus{}rhs\PYZus{}list}\PY{o}{=}\PY{p}{[}\PY{n}{k1\PYZus{}or\PYZus{}y\PYZus{}nplus\PYZus{}a21\PYZus{}k1\PYZus{}or\PYZus{}y\PYZus{}nplus1\PYZus{}running\PYZus{}total\PYZus{}gfs} \PY{o}{+} \PY{n}{Butcher}\PY{p}{[}\PY{l+m+mi}{3}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{3}\PY{p}{]}\PY{o}{*}\PY{n}{y\PYZus{}n\PYZus{}gfs}\PY{o}{*}\PY{n}{dt}\PY{p}{]}\PY{p}{,}
            \PY{n}{post\PYZus{}RHS\PYZus{}list}\PY{o}{=}\PY{p}{[}\PY{n}{post\PYZus{}RHS\PYZus{}string}\PY{p}{]}\PY{p}{,}
            \PY{n}{post\PYZus{}RHS\PYZus{}output\PYZus{}list}\PY{o}{=}\PY{p}{[}\PY{n}{y\PYZus{}n\PYZus{}gfs}\PY{p}{]}\PY{p}{,}
            \PY{n}{enable\PYZus{}SIMD}\PY{o}{=}\PY{n}{enable\PYZus{}SIMD}\PY{p}{,} \PY{n}{gf\PYZus{}aliases}\PY{o}{=}\PY{n}{gf\PYZus{}aliases}\PY{p}{,}
            \PY{n}{post\PYZus{}post\PYZus{}RHS\PYZus{}string}\PY{o}{=}\PY{n}{post\PYZus{}post\PYZus{}RHS\PYZus{}string}\PY{p}{)} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{// \PYZhy{}=}\PY{l+s+s2}{\PYZob{}}\PY{l+s+s2}{ END k3 substep \PYZcb{}=\PYZhy{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}
    \PY{k}{else}\PY{p}{:}
        \PY{n}{y\PYZus{}n} \PY{o}{=} \PY{n}{sp}\PY{o}{.}\PY{n}{Symbol}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{y\PYZus{}n\PYZus{}gfsL}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{real}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
        \PY{k}{if} \PY{o+ow}{not} \PY{n}{diagonal}\PY{p}{(}\PY{n}{MoL\PYZus{}method}\PY{p}{)}\PY{p}{:}
            \PY{k}{for} \PY{n}{s} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{num\PYZus{}steps}\PY{p}{)}\PY{p}{:}
                \PY{n}{next\PYZus{}y\PYZus{}input} \PY{o}{=} \PY{n}{sp}\PY{o}{.}\PY{n}{Symbol}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{next\PYZus{}y\PYZus{}input\PYZus{}gfsL}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{real}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}

                \PY{c+c1}{\PYZsh{} If we\PYZsq{}re on the first step (s=0), we use y\PYZus{}n gridfunction as input.}
                \PY{c+c1}{\PYZsh{}      Otherwise next\PYZus{}y\PYZus{}input is input. Output is just the reverse.}
                \PY{k}{if} \PY{n}{s} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{:}  \PY{c+c1}{\PYZsh{} If on first step:}
                    \PY{n}{RHS\PYZus{}input} \PY{o}{=} \PY{n}{y\PYZus{}n}
                \PY{k}{else}\PY{p}{:}  \PY{c+c1}{\PYZsh{} If on second step or later:}
                    \PY{n}{RHS\PYZus{}input} \PY{o}{=} \PY{n}{next\PYZus{}y\PYZus{}input}
                \PY{n}{RHS\PYZus{}output} \PY{o}{=} \PY{n}{sp}\PY{o}{.}\PY{n}{Symbol}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{k}\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{s} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZus{}gfs}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{real}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
                \PY{k}{if} \PY{n}{s} \PY{o}{==} \PY{n}{num\PYZus{}steps} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{:}  \PY{c+c1}{\PYZsh{} If on final step:}
                    \PY{n}{RK\PYZus{}lhs} \PY{o}{=} \PY{n}{y\PYZus{}n}
                \PY{k}{else}\PY{p}{:}  \PY{c+c1}{\PYZsh{} If on anything but the final step:}
                    \PY{n}{RK\PYZus{}lhs} \PY{o}{=} \PY{n}{next\PYZus{}y\PYZus{}input}
                \PY{n}{RK\PYZus{}rhs} \PY{o}{=} \PY{n}{y\PYZus{}n}
                \PY{k}{for} \PY{n}{m} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{s} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{:}
                    \PY{n}{k\PYZus{}mp1\PYZus{}gfs} \PY{o}{=} \PY{n}{sp}\PY{o}{.}\PY{n}{Symbol}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{k}\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{m} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZus{}gfsL}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
                    \PY{k}{if} \PY{n}{Butcher}\PY{p}{[}\PY{n}{s} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{[}\PY{n}{m} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{]} \PY{o}{!=} \PY{l+m+mi}{0}\PY{p}{:}
                        \PY{k}{if} \PY{n}{Butcher}\PY{p}{[}\PY{n}{s} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{[}\PY{n}{m} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{]} \PY{o}{!=} \PY{l+m+mi}{1}\PY{p}{:}
                            \PY{n}{RK\PYZus{}rhs} \PY{o}{+}\PY{o}{=} \PY{n}{dt} \PY{o}{*} \PY{n}{k\PYZus{}mp1\PYZus{}gfs}\PY{o}{*}\PY{n}{Butcher}\PY{p}{[}\PY{n}{s} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{[}\PY{n}{m} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{]}
                        \PY{k}{else}\PY{p}{:}
                            \PY{n}{RK\PYZus{}rhs} \PY{o}{+}\PY{o}{=} \PY{n}{dt} \PY{o}{*} \PY{n}{k\PYZus{}mp1\PYZus{}gfs}

                \PY{n}{post\PYZus{}RHS} \PY{o}{=} \PY{n}{post\PYZus{}RHS\PYZus{}string}
                \PY{k}{if} \PY{n}{s} \PY{o}{==} \PY{n}{num\PYZus{}steps} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{:}  \PY{c+c1}{\PYZsh{} If on final step:}
                    \PY{n}{post\PYZus{}RHS\PYZus{}output} \PY{o}{=} \PY{n}{y\PYZus{}n}
                \PY{k}{else}\PY{p}{:}  \PY{c+c1}{\PYZsh{} If on anything but the final step:}
                    \PY{n}{post\PYZus{}RHS\PYZus{}output} \PY{o}{=} \PY{n}{next\PYZus{}y\PYZus{}input}

                \PY{n}{body} \PY{o}{+}\PY{o}{=} \PY{n}{single\PYZus{}RK\PYZus{}substep\PYZus{}input\PYZus{}symbolic}\PY{p}{(}
                    \PY{n}{comment\PYZus{}block}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{// \PYZhy{}=}\PY{l+s+s2}{\PYZob{}}\PY{l+s+s2}{ START k}\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{s} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ substep \PYZcb{}=\PYZhy{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
                    \PY{n}{substep\PYZus{}time\PYZus{}offset\PYZus{}dt}\PY{o}{=}\PY{n}{Butcher}\PY{p}{[}\PY{n}{s}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,}
                    \PY{n}{RHS\PYZus{}str}\PY{o}{=}\PY{n}{RHS\PYZus{}string}\PY{p}{,}
                    \PY{n}{RHS\PYZus{}input\PYZus{}str}\PY{o}{=}\PY{n}{RHS\PYZus{}input}\PY{p}{,} \PY{n}{RHS\PYZus{}output\PYZus{}str}\PY{o}{=}\PY{n}{RHS\PYZus{}output}\PY{p}{,}
                    \PY{n}{RK\PYZus{}lhs\PYZus{}list}\PY{o}{=}\PY{p}{[}\PY{n}{RK\PYZus{}lhs}\PY{p}{]}\PY{p}{,} \PY{n}{RK\PYZus{}rhs\PYZus{}list}\PY{o}{=}\PY{p}{[}\PY{n}{RK\PYZus{}rhs}\PY{p}{]}\PY{p}{,}
                    \PY{n}{post\PYZus{}RHS\PYZus{}list}\PY{o}{=}\PY{p}{[}\PY{n}{post\PYZus{}RHS}\PY{p}{]}\PY{p}{,}
                    \PY{n}{post\PYZus{}RHS\PYZus{}output\PYZus{}list}\PY{o}{=}\PY{p}{[}\PY{n}{post\PYZus{}RHS\PYZus{}output}\PY{p}{]}\PY{p}{,}
                    \PY{n}{enable\PYZus{}SIMD}\PY{o}{=}\PY{n}{enable\PYZus{}SIMD}\PY{p}{,} \PY{n}{gf\PYZus{}aliases}\PY{o}{=}\PY{n}{gf\PYZus{}aliases}\PY{p}{,}
                    \PY{n}{post\PYZus{}post\PYZus{}RHS\PYZus{}string}\PY{o}{=}\PY{n}{post\PYZus{}post\PYZus{}RHS\PYZus{}string}\PY{p}{)} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{// \PYZhy{}=}\PY{l+s+s2}{\PYZob{}}\PY{l+s+s2}{ END k}\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{s} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ substep \PYZcb{}=\PYZhy{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}
        \PY{k}{else}\PY{p}{:}
            \PY{n}{y\PYZus{}n} \PY{o}{=} \PY{n}{sp}\PY{o}{.}\PY{n}{Symbol}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{y\PYZus{}n\PYZus{}gfsL}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{real}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
            \PY{n}{y\PYZus{}nplus1\PYZus{}running\PYZus{}total} \PY{o}{=} \PY{n}{sp}\PY{o}{.}\PY{n}{Symbol}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{y\PYZus{}nplus1\PYZus{}running\PYZus{}total\PYZus{}gfsL}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{real}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
            \PY{k}{if} \PY{n}{MoL\PYZus{}method} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Euler}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}  \PY{c+c1}{\PYZsh{} Euler\PYZsq{}s method doesn\PYZsq{}t require any k\PYZus{}i, and gets its own unique algorithm}
                \PY{n}{body} \PY{o}{+}\PY{o}{=} \PY{n}{single\PYZus{}RK\PYZus{}substep\PYZus{}input\PYZus{}symbolic}\PY{p}{(}
                    \PY{n}{comment\PYZus{}block}\PY{o}{=}\PY{n}{indent} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{// ***Euler timestepping only requires one RHS evaluation***}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
                    \PY{n}{substep\PYZus{}time\PYZus{}offset\PYZus{}dt}\PY{o}{=}\PY{n}{Butcher}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,}
                    \PY{n}{RHS\PYZus{}str}\PY{o}{=}\PY{n}{RHS\PYZus{}string}\PY{p}{,}
                    \PY{n}{RHS\PYZus{}input\PYZus{}str}\PY{o}{=}\PY{n}{y\PYZus{}n}\PY{p}{,} \PY{n}{RHS\PYZus{}output\PYZus{}str}\PY{o}{=}\PY{n}{y\PYZus{}nplus1\PYZus{}running\PYZus{}total}\PY{p}{,}
                    \PY{n}{RK\PYZus{}lhs\PYZus{}list}\PY{o}{=}\PY{p}{[}\PY{n}{y\PYZus{}n}\PY{p}{]}\PY{p}{,} \PY{n}{RK\PYZus{}rhs\PYZus{}list}\PY{o}{=}\PY{p}{[}\PY{n}{y\PYZus{}n} \PY{o}{+} \PY{n}{y\PYZus{}nplus1\PYZus{}running\PYZus{}total}\PY{o}{*}\PY{n}{dt}\PY{p}{]}\PY{p}{,}
                    \PY{n}{post\PYZus{}RHS\PYZus{}list}\PY{o}{=}\PY{p}{[}\PY{n}{post\PYZus{}RHS\PYZus{}string}\PY{p}{]}\PY{p}{,}
                    \PY{n}{post\PYZus{}RHS\PYZus{}output\PYZus{}list}\PY{o}{=}\PY{p}{[}\PY{n}{y\PYZus{}n}\PY{p}{]}\PY{p}{,}
                    \PY{n}{enable\PYZus{}SIMD}\PY{o}{=}\PY{n}{enable\PYZus{}SIMD}\PY{p}{,} \PY{n}{gf\PYZus{}aliases}\PY{o}{=}\PY{n}{gf\PYZus{}aliases}\PY{p}{,}
                    \PY{n}{post\PYZus{}post\PYZus{}RHS\PYZus{}string}\PY{o}{=}\PY{n}{post\PYZus{}post\PYZus{}RHS\PYZus{}string}\PY{p}{)}
            \PY{k}{else}\PY{p}{:}
                \PY{k}{for} \PY{n}{s} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{num\PYZus{}steps}\PY{p}{)}\PY{p}{:}
                    \PY{c+c1}{\PYZsh{} If we\PYZsq{}re on the first step (s=0), we use y\PYZus{}n gridfunction as input.}
                    \PY{c+c1}{\PYZsh{} and k\PYZus{}odd as output.}
                    \PY{k}{if} \PY{n}{s} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{:}
                        \PY{n}{RHS\PYZus{}input}  \PY{o}{=} \PY{n}{sp}\PY{o}{.}\PY{n}{Symbol}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{y\PYZus{}n\PYZus{}gfsL}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{real}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
                        \PY{n}{RHS\PYZus{}output} \PY{o}{=} \PY{n}{sp}\PY{o}{.}\PY{n}{Symbol}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{k\PYZus{}odd\PYZus{}gfsL}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{real}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
                    \PY{c+c1}{\PYZsh{} For the remaining steps the inputs and ouputs alternate between k\PYZus{}odd and k\PYZus{}even}
                    \PY{k}{elif} \PY{n}{s} \PY{o}{\PYZpc{}} \PY{l+m+mi}{2} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{:}
                        \PY{n}{RHS\PYZus{}input} \PY{o}{=} \PY{n}{sp}\PY{o}{.}\PY{n}{Symbol}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{k\PYZus{}even\PYZus{}gfsL}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{real}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
                        \PY{n}{RHS\PYZus{}output} \PY{o}{=} \PY{n}{sp}\PY{o}{.}\PY{n}{Symbol}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{k\PYZus{}odd\PYZus{}gfsL}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{real}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
                    \PY{k}{else}\PY{p}{:}
                        \PY{n}{RHS\PYZus{}input} \PY{o}{=} \PY{n}{sp}\PY{o}{.}\PY{n}{Symbol}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{k\PYZus{}odd\PYZus{}gfsL}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{real}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
                        \PY{n}{RHS\PYZus{}output} \PY{o}{=} \PY{n}{sp}\PY{o}{.}\PY{n}{Symbol}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{k\PYZus{}even\PYZus{}gfsL}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{real}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
                    \PY{n}{RK\PYZus{}lhs\PYZus{}list} \PY{o}{=} \PY{p}{[}\PY{p}{]}
                    \PY{n}{RK\PYZus{}rhs\PYZus{}list} \PY{o}{=} \PY{p}{[}\PY{p}{]}
                    \PY{k}{if} \PY{n}{s} \PY{o}{!=} \PY{n}{num\PYZus{}steps}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{:}  \PY{c+c1}{\PYZsh{} For anything besides the final step}
                        \PY{k}{if} \PY{n}{s} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{:}  \PY{c+c1}{\PYZsh{} The first RK step}
                            \PY{n}{RK\PYZus{}lhs\PYZus{}list}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{y\PYZus{}nplus1\PYZus{}running\PYZus{}total}\PY{p}{)}
                            \PY{n}{RK\PYZus{}rhs\PYZus{}list}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{RHS\PYZus{}output}\PY{o}{*}\PY{n}{dt}\PY{o}{*}\PY{n}{Butcher}\PY{p}{[}\PY{n}{num\PYZus{}steps}\PY{p}{]}\PY{p}{[}\PY{n}{s}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}

                            \PY{n}{RK\PYZus{}lhs\PYZus{}list}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{RHS\PYZus{}output}\PY{p}{)}
                            \PY{n}{RK\PYZus{}rhs\PYZus{}list}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{y\PYZus{}n} \PY{o}{+} \PY{n}{RHS\PYZus{}output}\PY{o}{*}\PY{n}{dt}\PY{o}{*}\PY{n}{Butcher}\PY{p}{[}\PY{n}{s}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{[}\PY{n}{s}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
                        \PY{k}{else}\PY{p}{:}
                            \PY{k}{if} \PY{n}{Butcher}\PY{p}{[}\PY{n}{num\PYZus{}steps}\PY{p}{]}\PY{p}{[}\PY{n}{s}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{!=} \PY{l+m+mi}{0}\PY{p}{:}
                                \PY{n}{RK\PYZus{}lhs\PYZus{}list}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{y\PYZus{}nplus1\PYZus{}running\PYZus{}total}\PY{p}{)}
                                \PY{k}{if} \PY{n}{Butcher}\PY{p}{[}\PY{n}{num\PYZus{}steps}\PY{p}{]}\PY{p}{[}\PY{n}{s}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{!=} \PY{l+m+mi}{1}\PY{p}{:}
                                    \PY{n}{RK\PYZus{}rhs\PYZus{}list}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{y\PYZus{}nplus1\PYZus{}running\PYZus{}total} \PY{o}{+} \PY{n}{RHS\PYZus{}output}\PY{o}{*}\PY{n}{dt}\PY{o}{*}\PY{n}{Butcher}\PY{p}{[}\PY{n}{num\PYZus{}steps}\PY{p}{]}\PY{p}{[}\PY{n}{s}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
                                \PY{k}{else}\PY{p}{:}
                                    \PY{n}{RK\PYZus{}rhs\PYZus{}list}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{y\PYZus{}nplus1\PYZus{}running\PYZus{}total} \PY{o}{+} \PY{n}{RHS\PYZus{}output}\PY{o}{*}\PY{n}{dt}\PY{p}{)}
                            \PY{k}{if} \PY{n}{Butcher}\PY{p}{[}\PY{n}{s}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{[}\PY{n}{s}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{!=} \PY{l+m+mi}{0}\PY{p}{:}
                                \PY{n}{RK\PYZus{}lhs\PYZus{}list}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{RHS\PYZus{}output}\PY{p}{)}
                                \PY{k}{if} \PY{n}{Butcher}\PY{p}{[}\PY{n}{s}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{[}\PY{n}{s}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{!=} \PY{l+m+mi}{1}\PY{p}{:}
                                    \PY{n}{RK\PYZus{}rhs\PYZus{}list}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{y\PYZus{}n} \PY{o}{+} \PY{n}{RHS\PYZus{}output}\PY{o}{*}\PY{n}{dt}\PY{o}{*}\PY{n}{Butcher}\PY{p}{[}\PY{n}{s}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{[}\PY{n}{s}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
                                \PY{k}{else}\PY{p}{:}
                                    \PY{n}{RK\PYZus{}rhs\PYZus{}list}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{y\PYZus{}n} \PY{o}{+} \PY{n}{RHS\PYZus{}output}\PY{o}{*}\PY{n}{dt}\PY{p}{)}
                        \PY{n}{post\PYZus{}RHS\PYZus{}output} \PY{o}{=} \PY{n}{RHS\PYZus{}output}
                    \PY{k}{if} \PY{n}{s} \PY{o}{==} \PY{n}{num\PYZus{}steps}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{:}  \PY{c+c1}{\PYZsh{} If on the final step}
                        \PY{k}{if} \PY{n}{Butcher}\PY{p}{[}\PY{n}{num\PYZus{}steps}\PY{p}{]}\PY{p}{[}\PY{n}{s}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{!=} \PY{l+m+mi}{0}\PY{p}{:}
                            \PY{n}{RK\PYZus{}lhs\PYZus{}list}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{y\PYZus{}n}\PY{p}{)}
                            \PY{k}{if} \PY{n}{Butcher}\PY{p}{[}\PY{n}{num\PYZus{}steps}\PY{p}{]}\PY{p}{[}\PY{n}{s}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{!=} \PY{l+m+mi}{1}\PY{p}{:}
                                \PY{n}{RK\PYZus{}rhs\PYZus{}list}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{y\PYZus{}n} \PY{o}{+} \PY{n}{y\PYZus{}nplus1\PYZus{}running\PYZus{}total} \PY{o}{+} \PY{n}{RHS\PYZus{}output}\PY{o}{*}\PY{n}{dt}\PY{o}{*}\PY{n}{Butcher}\PY{p}{[}\PY{n}{num\PYZus{}steps}\PY{p}{]}\PY{p}{[}\PY{n}{s}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
                            \PY{k}{else}\PY{p}{:}
                                \PY{n}{RK\PYZus{}rhs\PYZus{}list}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{y\PYZus{}n} \PY{o}{+} \PY{n}{y\PYZus{}nplus1\PYZus{}running\PYZus{}total} \PY{o}{+} \PY{n}{RHS\PYZus{}output}\PY{o}{*}\PY{n}{dt}\PY{p}{)}
                        \PY{n}{post\PYZus{}RHS\PYZus{}output} \PY{o}{=} \PY{n}{y\PYZus{}n}
                    \PY{n}{body} \PY{o}{+}\PY{o}{=} \PY{n}{single\PYZus{}RK\PYZus{}substep\PYZus{}input\PYZus{}symbolic}\PY{p}{(}
                        \PY{n}{comment\PYZus{}block}\PY{o}{=}\PY{n}{indent} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{// \PYZhy{}=}\PY{l+s+s2}{\PYZob{}}\PY{l+s+s2}{ START k}\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{s} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ substep \PYZcb{}=\PYZhy{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
                        \PY{n}{substep\PYZus{}time\PYZus{}offset\PYZus{}dt}\PY{o}{=}\PY{n}{Butcher}\PY{p}{[}\PY{n}{s}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,}
                        \PY{n}{RHS\PYZus{}str}\PY{o}{=}\PY{n}{RHS\PYZus{}string}\PY{p}{,}
                        \PY{n}{RHS\PYZus{}input\PYZus{}str}\PY{o}{=}\PY{n}{RHS\PYZus{}input}\PY{p}{,} \PY{n}{RHS\PYZus{}output\PYZus{}str}\PY{o}{=}\PY{n}{RHS\PYZus{}output}\PY{p}{,}
                        \PY{n}{RK\PYZus{}lhs\PYZus{}list}\PY{o}{=}\PY{n}{RK\PYZus{}lhs\PYZus{}list}\PY{p}{,} \PY{n}{RK\PYZus{}rhs\PYZus{}list}\PY{o}{=}\PY{n}{RK\PYZus{}rhs\PYZus{}list}\PY{p}{,}
                        \PY{n}{post\PYZus{}RHS\PYZus{}list}\PY{o}{=}\PY{p}{[}\PY{n}{post\PYZus{}RHS\PYZus{}string}\PY{p}{]}\PY{p}{,}
                        \PY{n}{post\PYZus{}RHS\PYZus{}output\PYZus{}list}\PY{o}{=}\PY{p}{[}\PY{n}{post\PYZus{}RHS\PYZus{}output}\PY{p}{]}\PY{p}{,}
                        \PY{n}{enable\PYZus{}SIMD}\PY{o}{=}\PY{n}{enable\PYZus{}SIMD}\PY{p}{,} \PY{n}{gf\PYZus{}aliases}\PY{o}{=}\PY{n}{gf\PYZus{}aliases}\PY{p}{,}
                        \PY{n}{post\PYZus{}post\PYZus{}RHS\PYZus{}string}\PY{o}{=}\PY{n}{post\PYZus{}post\PYZus{}RHS\PYZus{}string}\PY{p}{)} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{// \PYZhy{}=}\PY{l+s+s2}{\PYZob{}}\PY{l+s+s2}{ END k}\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{s} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ substep \PYZcb{}=\PYZhy{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}

    \PY{n}{body} \PY{o}{+}\PY{o}{=} \PY{l+s+s2}{\PYZdq{}\PYZdq{}\PYZdq{}}
\PY{l+s+s2}{// To minimize roundoff error (from adding dt to params.time lots of times),}
\PY{l+s+s2}{//   here we set time based on the iteration number.}
\PY{l+s+s2}{griddata\PYZhy{}\PYZgt{}params.time = (REAL)(griddata\PYZhy{}\PYZgt{}params.n + 1) * griddata\PYZhy{}\PYZgt{}params.dt;}

\PY{l+s+s2}{// Finally, increment the timestep n:}
\PY{l+s+s2}{griddata\PYZhy{}\PYZgt{}params.n++;}
\PY{l+s+s2}{\PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{enableCparameters}\PY{o}{=}\PY{k+kc}{False}
    \PY{n}{add\PYZus{}to\PYZus{}Cfunction\PYZus{}dict}\PY{p}{(}
        \PY{n}{includes}\PY{o}{=}\PY{n}{includes}\PY{p}{,}
        \PY{n}{desc}\PY{o}{=}\PY{n}{desc}\PY{p}{,}
        \PY{n}{c\PYZus{}type}\PY{o}{=}\PY{n}{c\PYZus{}type}\PY{p}{,} \PY{n}{name}\PY{o}{=}\PY{n}{name}\PY{p}{,} \PY{n}{params}\PY{o}{=}\PY{n}{params}\PY{p}{,}
        \PY{n}{body}\PY{o}{=}\PY{n}{indent\PYZus{}Ccode}\PY{p}{(}\PY{n}{body}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{  }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
        \PY{n}{enableCparameters}\PY{o}{=}\PY{n}{enableCparameters}\PY{p}{,} \PY{n}{rel\PYZus{}path\PYZus{}to\PYZus{}Cparams}\PY{o}{=}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{.}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \hypertarget{step-3.d-memory-deallocation-mol_free_memory-back-to-top}{%
\subsection{\texorpdfstring{Step 3.d: Memory deallocation:
\texttt{MoL\_free\_memory()} {[}Back to
\hyperref[toc]{top}{]}}{Step 3.d: Memory deallocation: MoL\_free\_memory() {[}Back to {]}}}\label{step-3.d-memory-deallocation-mol_free_memory-back-to-top}}

\[\label{free}\]

We define the function \texttt{MoL\_free\_memory()} which generates the
C code for freeing the memory that was being occupied by the grid
functions lists that had been allocated.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{7}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} add\PYZus{}to\PYZus{}Cfunction\PYZus{}dict\PYZus{}MoL\PYZus{}free\PYZus{}memory() registers}
\PY{c+c1}{\PYZsh{}           MoL\PYZus{}free\PYZus{}memory\PYZus{}y\PYZus{}n\PYZus{}gfs() and}
\PY{c+c1}{\PYZsh{}           MoL\PYZus{}free\PYZus{}memory\PYZus{}non\PYZus{}y\PYZus{}n\PYZus{}gfs(), which free memory for}
\PY{c+c1}{\PYZsh{}           the indicated sets of gridfunctions}
\PY{k}{def} \PY{n+nf}{add\PYZus{}to\PYZus{}Cfunction\PYZus{}dict\PYZus{}MoL\PYZus{}free\PYZus{}memory}\PY{p}{(}\PY{n}{MoL\PYZus{}method}\PY{p}{,} \PY{n}{which\PYZus{}gfs}\PY{p}{)}\PY{p}{:}
    \PY{n}{includes} \PY{o}{=} \PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{NRPy\PYZus{}basic\PYZus{}defines.h}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{NRPy\PYZus{}function\PYZus{}prototypes.h}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}
    \PY{n}{desc} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Method of Lines (MoL) for }\PY{l+s+se}{\PYZbs{}\PYZdq{}}\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n}{MoL\PYZus{}method} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}\PYZdq{}}\PY{l+s+s2}{ method: Free memory for }\PY{l+s+se}{\PYZbs{}\PYZdq{}}\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n}{which\PYZus{}gfs} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}\PYZdq{}}\PY{l+s+s2}{ gridfunctions}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}
    \PY{n}{desc} \PY{o}{+}\PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{   \PYZhy{} y\PYZus{}n\PYZus{}gfs are used to store data for the vector of gridfunctions y\PYZus{}i at t\PYZus{}n, at the start of each MoL timestep}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}
    \PY{n}{desc} \PY{o}{+}\PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{   \PYZhy{} non\PYZus{}y\PYZus{}n\PYZus{}gfs are needed for intermediate (e.g., k\PYZus{}i) storage in chosen MoL method}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}
    \PY{n}{c\PYZus{}type} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{void}\PY{l+s+s2}{\PYZdq{}}

    \PY{n}{y\PYZus{}n\PYZus{}gridfunctions}\PY{p}{,} \PY{n}{non\PYZus{}y\PYZus{}n\PYZus{}gridfunctions\PYZus{}list}\PY{p}{,} \PY{n}{\PYZus{}diagnostic\PYZus{}gridfunctions\PYZus{}point\PYZus{}to}\PY{p}{,} \PYZbs{}
        \PY{n}{\PYZus{}diagnostic\PYZus{}gridfunctions2\PYZus{}point\PYZus{}to} \PY{o}{=} \PY{n}{generate\PYZus{}gridfunction\PYZus{}names}\PY{p}{(}\PY{n}{MoL\PYZus{}method}\PY{o}{=}\PY{n}{MoL\PYZus{}method}\PY{p}{)}

    \PY{k}{if} \PY{n}{which\PYZus{}gfs} \PY{o}{==} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{y\PYZus{}n\PYZus{}gfs}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:}
        \PY{n}{gridfunctions\PYZus{}list} \PY{o}{=} \PY{p}{[}\PY{n}{y\PYZus{}n\PYZus{}gridfunctions}\PY{p}{]}
    \PY{k}{elif} \PY{n}{which\PYZus{}gfs} \PY{o}{==} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{non\PYZus{}y\PYZus{}n\PYZus{}gfs}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:}
        \PY{n}{gridfunctions\PYZus{}list} \PY{o}{=} \PY{n}{non\PYZus{}y\PYZus{}n\PYZus{}gridfunctions\PYZus{}list}
    \PY{k}{else}\PY{p}{:}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ERROR: which\PYZus{}gfs = }\PY{l+s+se}{\PYZbs{}\PYZdq{}}\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n}{which\PYZus{}gfs} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}\PYZdq{}}\PY{l+s+s2}{ unrecognized.}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
        \PY{n}{sys}\PY{o}{.}\PY{n}{exit}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{)}
    \PY{n}{name} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{MoL\PYZus{}free\PYZus{}memory\PYZus{}}\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n}{which\PYZus{}gfs}
    \PY{n}{params} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{const paramstruct *restrict params, MoL\PYZus{}gridfunctions\PYZus{}struct *restrict gridfuncs}\PY{l+s+s2}{\PYZdq{}}
    \PY{n}{body} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZdq{}}
    \PY{k}{for} \PY{n}{gridfunctions} \PY{o+ow}{in} \PY{n}{gridfunctions\PYZus{}list}\PY{p}{:}
        \PY{n}{body} \PY{o}{+}\PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{    free(gridfuncs\PYZhy{}\PYZgt{}}\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n}{gridfunctions} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{);}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}
    \PY{n}{add\PYZus{}to\PYZus{}Cfunction\PYZus{}dict}\PY{p}{(}
        \PY{n}{includes}\PY{o}{=}\PY{n}{includes}\PY{p}{,}
        \PY{n}{desc}\PY{o}{=}\PY{n}{desc}\PY{p}{,}
        \PY{n}{c\PYZus{}type}\PY{o}{=}\PY{n}{c\PYZus{}type}\PY{p}{,} \PY{n}{name}\PY{o}{=}\PY{n}{name}\PY{p}{,} \PY{n}{params}\PY{o}{=}\PY{n}{params}\PY{p}{,}
        \PY{n}{body}\PY{o}{=}\PY{n}{indent\PYZus{}Ccode}\PY{p}{(}\PY{n}{body}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{  }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
        \PY{n}{rel\PYZus{}path\PYZus{}to\PYZus{}Cparams}\PY{o}{=}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{.}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \hypertarget{step-3.e-define-register-mol_gridfunctions_struct-in-nrpy_basic_defines.h-nrpy_basic_defines_mol_timestepping_struct-back-to-top}{%
\subsection{\texorpdfstring{Step 3.e: Define \& register
\texttt{MoL\_gridfunctions\_struct} in \texttt{NRPy\_basic\_defines.h}:
\texttt{NRPy\_basic\_defines\_MoL\_timestepping\_struct()} {[}Back to
\hyperref[toc]{top}{]}}{Step 3.e: Define \& register MoL\_gridfunctions\_struct in NRPy\_basic\_defines.h: NRPy\_basic\_defines\_MoL\_timestepping\_struct() {[}Back to {]}}}\label{step-3.e-define-register-mol_gridfunctions_struct-in-nrpy_basic_defines.h-nrpy_basic_defines_mol_timestepping_struct-back-to-top}}

\[\label{nrpybasicdefines}\]

\texttt{MoL\_gridfunctions\_struct} stores pointers to all the
gridfunctions needed by MoL, and we define this struct within
\texttt{NRPy\_basic\_defines.h}.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{8}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Register MoL\PYZus{}gridfunctions\PYZus{}struct in NRPy\PYZus{}basic\PYZus{}defines}
\PY{k}{def} \PY{n+nf}{NRPy\PYZus{}basic\PYZus{}defines\PYZus{}MoL\PYZus{}timestepping\PYZus{}struct}\PY{p}{(}\PY{n}{MoL\PYZus{}method}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{RK4}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{:}
    \PY{n}{y\PYZus{}n\PYZus{}gridfunctions}\PY{p}{,} \PY{n}{non\PYZus{}y\PYZus{}n\PYZus{}gridfunctions\PYZus{}list}\PY{p}{,} \PY{n}{\PYZus{}diagnostic\PYZus{}gridfunctions\PYZus{}point\PYZus{}to}\PY{p}{,} \PYZbs{}
        \PY{n}{\PYZus{}diagnostic\PYZus{}gridfunctions2\PYZus{}point\PYZus{}to} \PY{o}{=} \PY{n}{generate\PYZus{}gridfunction\PYZus{}names}\PY{p}{(}\PY{n}{MoL\PYZus{}method}\PY{o}{=}\PY{n}{MoL\PYZus{}method}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} Step 3.b: Create MoL\PYZus{}timestepping struct:}
    \PY{n}{indent} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{  }\PY{l+s+s2}{\PYZdq{}}
    \PY{n}{Nbd} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{typedef struct \PYZus{}\PYZus{}MoL\PYZus{}gridfunctions\PYZus{}struct\PYZus{}\PYZus{} }\PY{l+s+s2}{\PYZob{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}
    \PY{n}{Nbd} \PY{o}{+}\PY{o}{=} \PY{n}{indent} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{REAL *restrict }\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n}{y\PYZus{}n\PYZus{}gridfunctions} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{;}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}
    \PY{k}{for} \PY{n}{gfs} \PY{o+ow}{in} \PY{n}{non\PYZus{}y\PYZus{}n\PYZus{}gridfunctions\PYZus{}list}\PY{p}{:}
        \PY{n}{Nbd} \PY{o}{+}\PY{o}{=} \PY{n}{indent} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{REAL *restrict }\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n}{gfs} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{;}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}
    \PY{n}{Nbd} \PY{o}{+}\PY{o}{=} \PY{n}{indent} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{REAL *restrict diagnostic\PYZus{}output\PYZus{}gfs;}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}
    \PY{n}{Nbd} \PY{o}{+}\PY{o}{=} \PY{n}{indent} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{REAL *restrict diagnostic\PYZus{}output\PYZus{}gfs2;}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}
    \PY{n}{Nbd} \PY{o}{+}\PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZcb{} MoL\PYZus{}gridfunctions\PYZus{}struct;}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}
    \PY{n}{Nbd} \PY{o}{+}\PY{o}{=} \PY{l+s+s2}{\PYZdq{}\PYZdq{}\PYZdq{}}\PY{l+s+s2}{\PYZsh{}define LOOP\PYZus{}ALL\PYZus{}GFS\PYZus{}GPS(ii) \PYZus{}Pragma(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{omp parallel for}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{) }\PY{l+s+se}{\PYZbs{}\PYZbs{}}
\PY{l+s+s2}{  for(int (ii)=0;(ii)\PYZlt{}Nxx\PYZus{}plus\PYZus{}2NGHOSTS0*Nxx\PYZus{}plus\PYZus{}2NGHOSTS1*Nxx\PYZus{}plus\PYZus{}2NGHOSTS2*NUM\PYZus{}EVOL\PYZus{}GFS;(ii)++)}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}\PYZdq{}\PYZdq{}}

    \PY{n}{outC\PYZus{}NRPy\PYZus{}basic\PYZus{}defines\PYZus{}h\PYZus{}dict}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{MoL}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]} \PY{o}{=} \PY{n}{Nbd}
\end{Verbatim}
\end{tcolorbox}

    \hypertarget{step-3.f-add-all-mol-c-codes-to-c-function-dictionary-and-add-mol-definitions-to-nrpy_basic_defines.h-register_c_functions_and_nrpy_basic_defines-back-to-top}{%
\subsection{\texorpdfstring{Step 3.f: Add all MoL C codes to C function
dictionary, and add MoL definitions to \texttt{NRPy\_basic\_defines.h}:
\texttt{register\_C\_functions\_and\_NRPy\_basic\_defines()} {[}Back to
\hyperref[toc]{top}{]}}{Step 3.f: Add all MoL C codes to C function dictionary, and add MoL definitions to NRPy\_basic\_defines.h: register\_C\_functions\_and\_NRPy\_basic\_defines() {[}Back to {]}}}\label{step-3.f-add-all-mol-c-codes-to-c-function-dictionary-and-add-mol-definitions-to-nrpy_basic_defines.h-register_c_functions_and_nrpy_basic_defines-back-to-top}}

\[\label{setupall}\]

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{9}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Finally declare the master registration function}
\PY{k}{def} \PY{n+nf}{register\PYZus{}C\PYZus{}functions\PYZus{}and\PYZus{}NRPy\PYZus{}basic\PYZus{}defines}\PY{p}{(}\PY{n}{MoL\PYZus{}method} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{RK4}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
            \PY{n}{RHS\PYZus{}string} \PY{o}{=}  \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{rhs\PYZus{}eval(Nxx,Nxx\PYZus{}plus\PYZus{}2NGHOSTS,dxx, RK\PYZus{}INPUT\PYZus{}GFS, RK\PYZus{}OUTPUT\PYZus{}GFS);}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
            \PY{n}{post\PYZus{}RHS\PYZus{}string} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{apply\PYZus{}bcs(Nxx,Nxx\PYZus{}plus\PYZus{}2NGHOSTS, RK\PYZus{}OUTPUT\PYZus{}GFS);}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{post\PYZus{}post\PYZus{}RHS\PYZus{}string} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
            \PY{n}{enable\PYZus{}rfm}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,} \PY{n}{enable\PYZus{}curviBCs}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,} \PY{n}{enable\PYZus{}SIMD}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}\PY{p}{:}
    \PY{k}{for} \PY{n}{which\PYZus{}gfs} \PY{o+ow}{in} \PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{y\PYZus{}n\PYZus{}gfs}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{non\PYZus{}y\PYZus{}n\PYZus{}gfs}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{:}
        \PY{n}{add\PYZus{}to\PYZus{}Cfunction\PYZus{}dict\PYZus{}MoL\PYZus{}malloc}\PY{p}{(}\PY{n}{MoL\PYZus{}method}\PY{p}{,} \PY{n}{which\PYZus{}gfs}\PY{p}{)}
        \PY{n}{add\PYZus{}to\PYZus{}Cfunction\PYZus{}dict\PYZus{}MoL\PYZus{}free\PYZus{}memory}\PY{p}{(}\PY{n}{MoL\PYZus{}method}\PY{p}{,} \PY{n}{which\PYZus{}gfs}\PY{p}{)}
    \PY{n}{add\PYZus{}to\PYZus{}Cfunction\PYZus{}dict\PYZus{}MoL\PYZus{}step\PYZus{}forward\PYZus{}in\PYZus{}time}\PY{p}{(}\PY{n}{MoL\PYZus{}method}\PY{p}{,} \PY{n}{RHS\PYZus{}string}\PY{p}{,} \PY{n}{post\PYZus{}RHS\PYZus{}string}\PY{p}{,} \PY{n}{post\PYZus{}post\PYZus{}RHS\PYZus{}string}\PY{p}{,}
                                                   \PY{n}{enable\PYZus{}rfm}\PY{o}{=}\PY{n}{enable\PYZus{}rfm}\PY{p}{,} \PY{n}{enable\PYZus{}curviBCs}\PY{o}{=}\PY{n}{enable\PYZus{}curviBCs}\PY{p}{,}
                                                   \PY{n}{enable\PYZus{}SIMD}\PY{o}{=}\PY{n}{enable\PYZus{}SIMD}\PY{p}{)}
    \PY{n}{NRPy\PYZus{}basic\PYZus{}defines\PYZus{}MoL\PYZus{}timestepping\PYZus{}struct}\PY{p}{(}\PY{n}{MoL\PYZus{}method}\PY{o}{=}\PY{n}{MoL\PYZus{}method}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \hypertarget{step-4-code-validation-against-moltimestepping.mol-nrpy-module-back-to-top}{%
\section{\texorpdfstring{Step 4: Code Validation against
\texttt{MoLtimestepping.MoL} NRPy+ module {[}Back to
\hyperref[toc]{top}{]}}{Step 4: Code Validation against MoLtimestepping.MoL NRPy+ module {[}Back to {]}}}\label{step-4-code-validation-against-moltimestepping.mol-nrpy-module-back-to-top}}

\[\label{code_validation}\]

As a code validation check, we verify agreement in the dictionary of
Butcher tables between

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  this tutorial and
\item
  the NRPy+ \href{../edit/MoLtimestepping/MoL.py}{MoLtimestepping.MoL}
  module.
\end{enumerate}

We generate the header files for each RK method and check for agreement
with the NRPy+ module.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{11}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import} \PY{n+nn}{sys}
\PY{k+kn}{import} \PY{n+nn}{MoLtimestepping}\PY{n+nn}{.}\PY{n+nn}{MoL} \PY{k}{as} \PY{n+nn}{MoLC}
\PY{k+kn}{import} \PY{n+nn}{difflib}
\PY{k+kn}{import} \PY{n+nn}{pprint}
\PY{c+c1}{\PYZsh{} Courtesy https://stackoverflow.com/questions/12956957/print\PYZhy{}diff\PYZhy{}of\PYZhy{}python\PYZhy{}dictionaries ,}
\PY{c+c1}{\PYZsh{}   which itself is an adaptation of some Cpython core code}
\PY{k}{def} \PY{n+nf}{compare\PYZus{}dicts}\PY{p}{(}\PY{n}{d1}\PY{p}{,} \PY{n}{d2}\PY{p}{)}\PY{p}{:}
    \PY{k}{return} \PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{\PYZsq{}} \PY{o}{+} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{difflib}\PY{o}{.}\PY{n}{ndiff}\PY{p}{(}
                   \PY{n}{pprint}\PY{o}{.}\PY{n}{pformat}\PY{p}{(}\PY{n}{d1}\PY{p}{)}\PY{o}{.}\PY{n}{splitlines}\PY{p}{(}\PY{p}{)}\PY{p}{,}
                   \PY{n}{pprint}\PY{o}{.}\PY{n}{pformat}\PY{p}{(}\PY{n}{d2}\PY{p}{)}\PY{o}{.}\PY{n}{splitlines}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}


\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{ \PYZsh{}\PYZsh{}\PYZsh{} BEGIN VALIDATION TESTS \PYZsh{}\PYZsh{}\PYZsh{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{k}{for} \PY{n}{key}\PY{p}{,} \PY{n}{value} \PY{o+ow}{in} \PY{n}{Butcher\PYZus{}dict}\PY{o}{.}\PY{n}{items}\PY{p}{(}\PY{p}{)}\PY{p}{:}
    \PY{k}{if} \PY{n}{key} \PY{o+ow}{not} \PY{o+ow}{in} \PY{p}{\PYZob{}}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AHE}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ABS}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ARKF}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ACK}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ADP5}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ADP8}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AB}\PY{l+s+s2}{\PYZdq{}}\PY{p}{\PYZcb{}}\PY{p}{:}
        \PY{c+c1}{\PYZsh{} This validation does not work on anything other than standard RK methods, so they are excluded.}
        \PY{n}{register\PYZus{}C\PYZus{}functions\PYZus{}and\PYZus{}NRPy\PYZus{}basic\PYZus{}defines}\PY{p}{(}\PY{n}{key}\PY{p}{,}
                                \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{rhs\PYZus{}eval(Nxx,Nxx\PYZus{}plus\PYZus{}2NGHOSTS,dxx, RK\PYZus{}INPUT\PYZus{}GFS, RK\PYZus{}OUTPUT\PYZus{}GFS);}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
                               \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{apply\PYZus{}bcs(Nxx,Nxx\PYZus{}plus\PYZus{}2NGHOSTS, RK\PYZus{}OUTPUT\PYZus{}GFS);}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
        \PY{k+kn}{from} \PY{n+nn}{outputC} \PY{k+kn}{import} \PY{n}{outC\PYZus{}function\PYZus{}dict}\PY{p}{,} \PY{n}{outC\PYZus{}function\PYZus{}master\PYZus{}list}
        \PY{n}{notebook\PYZus{}dict} \PY{o}{=} \PY{n}{outC\PYZus{}function\PYZus{}dict}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}
        \PY{n}{notebook\PYZus{}master\PYZus{}list} \PY{o}{=} \PY{n+nb}{list}\PY{p}{(}\PY{n}{outC\PYZus{}function\PYZus{}master\PYZus{}list}\PY{p}{)}
        \PY{n}{outC\PYZus{}function\PYZus{}dict}\PY{o}{.}\PY{n}{clear}\PY{p}{(}\PY{p}{)}
        \PY{k}{del} \PY{n}{outC\PYZus{}function\PYZus{}master\PYZus{}list}\PY{p}{[}\PY{p}{:}\PY{p}{]}
        \PY{k+kn}{from} \PY{n+nn}{outputC} \PY{k+kn}{import} \PY{n}{outC\PYZus{}function\PYZus{}dict}
        \PY{k}{if} \PY{n}{outC\PYZus{}function\PYZus{}dict} \PY{o}{!=} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}\PY{p}{:}
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Error in clearing outC\PYZus{}function\PYZus{}dict.}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
            \PY{n}{sys}\PY{o}{.}\PY{n}{exit}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{)}
        \PY{n}{MoLC}\PY{o}{.}\PY{n}{register\PYZus{}C\PYZus{}functions\PYZus{}and\PYZus{}NRPy\PYZus{}basic\PYZus{}defines}\PY{p}{(}\PY{n}{key}\PY{p}{,}
                                \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{rhs\PYZus{}eval(Nxx,Nxx\PYZus{}plus\PYZus{}2NGHOSTS,dxx, RK\PYZus{}INPUT\PYZus{}GFS, RK\PYZus{}OUTPUT\PYZus{}GFS);}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
                               \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{apply\PYZus{}bcs(Nxx,Nxx\PYZus{}plus\PYZus{}2NGHOSTS, RK\PYZus{}OUTPUT\PYZus{}GFS);}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
        \PY{k+kn}{from} \PY{n+nn}{outputC} \PY{k+kn}{import} \PY{n}{outC\PYZus{}function\PYZus{}dict}
        \PY{n}{python\PYZus{}module\PYZus{}dict} \PY{o}{=} \PY{n}{outC\PYZus{}function\PYZus{}dict}

        \PY{k}{if} \PY{n}{notebook\PYZus{}dict} \PY{o}{!=} \PY{n}{python\PYZus{}module\PYZus{}dict}\PY{p}{:}
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{VALIDATION TEST FAILED.}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
            \PY{n+nb}{print}\PY{p}{(}\PY{n}{compare\PYZus{}dicts}\PY{p}{(}\PY{n}{notebook\PYZus{}dict}\PY{p}{,} \PY{n}{python\PYZus{}module\PYZus{}dict}\PY{p}{)}\PY{p}{)}
            \PY{n}{sys}\PY{o}{.}\PY{n}{exit}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{VALIDATION TEST PASSED on all files from }\PY{l+s+s2}{\PYZdq{}}\PY{o}{+}\PY{n+nb}{str}\PY{p}{(}\PY{n}{key}\PY{p}{)}\PY{o}{+}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ method}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZsh{}\PYZsh{}\PYZsh{} END VALIDATION TESTS \PYZsh{}\PYZsh{}\PYZsh{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]


 \#\#\# BEGIN VALIDATION TESTS \#\#\#
VALIDATION TEST PASSED on all files from Euler method
VALIDATION TEST PASSED on all files from RK2 Heun method
VALIDATION TEST PASSED on all files from RK2 MP method
VALIDATION TEST PASSED on all files from RK2 Ralston method
VALIDATION TEST PASSED on all files from RK3 method
VALIDATION TEST PASSED on all files from RK3 Heun method
VALIDATION TEST PASSED on all files from RK3 Ralston method
VALIDATION TEST PASSED on all files from SSPRK3 method
VALIDATION TEST PASSED on all files from RK4 method
VALIDATION TEST PASSED on all files from DP5 method
VALIDATION TEST PASSED on all files from DP5alt method
VALIDATION TEST PASSED on all files from CK5 method
VALIDATION TEST PASSED on all files from DP6 method
VALIDATION TEST PASSED on all files from L6 method
VALIDATION TEST PASSED on all files from DP8 method
\#\#\# END VALIDATION TESTS \#\#\#
    \end{Verbatim}

    \hypertarget{step-5-output-this-notebook-to-latex-formatted-pdf-back-to-top}{%
\section{\texorpdfstring{Step 5: Output this notebook to
\(\LaTeX\)-formatted PDF {[}Back to
\hyperref[toc]{top}{]}}{Step 5: Output this notebook to \textbackslash LaTeX-formatted PDF {[}Back to {]}}}\label{step-5-output-this-notebook-to-latex-formatted-pdf-back-to-top}}

\[\label{latex_pdf_output}\]

The following code cell converts this Jupyter notebook into a proper,
clickable \(\LaTeX\)-formatted PDF file. After the cell is successfully
run, the generated PDF may be found in the root NRPy+ tutorial
directory, with filename
\url{Tutorial-RK_Butcher_Table_Generating_C_Code.pdf}. (Note that
clicking on this link may not work; you may need to open the PDF file
through another means.)

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import} \PY{n+nn}{cmdline\PYZus{}helper} \PY{k}{as} \PY{n+nn}{cmd}    \PY{c+c1}{\PYZsh{} NRPy+: Multi\PYZhy{}platform Python command\PYZhy{}line interface}
\PY{n}{cmd}\PY{o}{.}\PY{n}{output\PYZus{}Jupyter\PYZus{}notebook\PYZus{}to\PYZus{}LaTeXed\PYZus{}PDF}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Tutorial\PYZhy{}Method\PYZus{}of\PYZus{}Lines\PYZhy{}C\PYZus{}Code\PYZus{}Generation}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}


    % Add a bibliography block to the postdoc
    
    
    
\end{document}
